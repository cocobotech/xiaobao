<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COCOBO Â· CHESS</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    background: #1d3e2f;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-family: 'Segoe UI', Roboto, sans-serif;
    padding: 10px 10px 10px;
    gap: 0;
}

.main-layout {
    display: flex;
    width: 1350px; /* å æ®å‡ ä¹å…¨å±å®½åº¦ */
    max-width: 100%;
    background: #3c5e4e;
    border-radius: 50px;
    box-shadow: 0 30px 40px rgba(0,0,0,0.7);
    overflow: hidden;
    border: 4px solid #d4a15e;
    min-height: 700px;
}

/* â”€â”€ Left panel â”€â”€ */
.left-panel {
    width: 220px;
    flex-shrink: 0;
    background: linear-gradient(165deg, #234437, #0f2f22);
    padding: 25px 14px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 26px;
    border-right: 4px solid #c1974f;
}

.cocobo-logo {
    font-family: 'Impact','Arial Black',sans-serif;
    background: #f3c26b;
    color: #2d4a34;
    padding: 14px 10px 12px;
    border-radius: 40px;
    box-shadow: 0 10px 0 #7b5a2c, 0 18px 16px rgba(0,0,0,.4),
                inset 0 -4px 8px #e9b152, inset 0 4px 8px #ffe29c;
    transform: perspective(800px) rotateX(6deg) rotateY(-2deg);
    border: 2px solid #fde3a5;
    width: 100%;
    text-align: center;
    line-height: 1;
    transition: transform .2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}
.cocobo-logo:hover { transform: perspective(800px) rotateX(3deg) scale(1.02); }
.cocobo-logo .logo-main {
    font-size: 2.2rem;
    font-weight: 900;
    letter-spacing: 5px;
    text-shadow: 1px 3px 0 #a47e3d, 3px 5px 0 #364e2e;
    display: block;
}
.cocobo-logo .logo-sub {
    font-size: .76rem;
    font-weight: 700;
    font-family: 'Georgia', serif;
    letter-spacing: .18em;
    color: #3a2e10;
    text-shadow: 0 1px 0 #cfb057;
    display: block;
    border-top: 1px solid rgba(100,70,10,.25);
    padding-top: 5px;
    width: 80%;
}

.mode-btn {
    width: 100%;
    background: #dab983;
    border: none;
    padding: 14px 8px 12px;
    border-radius: 40px;
    font-weight: bold;
    color: #1f3a2a;
    border-bottom: 6px solid #7b623e;
    cursor: pointer;
    transition: .08s;
    box-shadow: 0 8px 0 #3f321e, 0 10px 15px black;
    font-family: 'Georgia',serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
}
.mode-btn:active { transform: translateY(6px); border-bottom-width: 2px; box-shadow: 0 2px 0 #3f321e; }
.mode-btn.active { background: #f3d99c; border-bottom-color: #aa7c3a; box-shadow: 0 8px 0 #7b5f2e, 0 10px 15px black; }
.mode-btn .btn-zh { font-size: 1.1rem; letter-spacing: .5px; }
.mode-btn .btn-en { font-size: .63rem; font-family: 'Segoe UI',sans-serif; font-weight: 600; letter-spacing: .07em; color: #3d2e0f; opacity: .78; }

/* â”€â”€ Center panel â”€â”€ */
.center-panel {
    flex: 1;
    background: #ecdbbd;
    padding: 22px 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 0;
    gap: 14px;
}

/* â”€â”€ Board shell â”€â”€ */
.chess-board-shell {
    width: min(95vw, 600px);
    max-width: 750px;
    position: relative;
    aspect-ratio: 1/1;

    border-radius: 4px; /* å†…éƒ¨æ£‹ç›˜å¾®åœ†è§’ */
}

.custom-board {
    width: 100%;
    aspect-ratio: 1/1;
    background: #deb887;
    border: 8px solid #5f3f1a;
    border-radius: 20px;
    overflow: hidden;
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    box-shadow: 0 14px 0 #3f2f1b, 0 20px 30px rgba(0,0,0,.5);
    user-select: none;
}

.custom-cell {
    aspect-ratio: 1/1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(1.4rem, 3.5vw, 3.2rem); 
    /*font-size: font-size: clamp(1.2rem, 3vw, 2.5rem);  */
    
    position: relative;
    cursor: default;
    transition: background .12s;
}
.custom-light { background: #eed9b2; }
.custom-dark  { background: #8b6f4c; }

.move-dot::after {
    content: "";
    position: absolute;
    width: 32%; height: 32%;
    background: #27ae60;
    border-radius: 50%;
    opacity: .85;
    border: 2px solid rgba(255,255,255,.7);
    box-shadow: 0 2px 6px rgba(0,0,0,.4);
    pointer-events: none;
}
.capture-arrow::before {
    content: "âš”ï¸";
    position: absolute;
    font-size: 1.6rem;
    z-index: 10;
    text-shadow: 0 0 8px darkred;
    pointer-events: none;
}

@keyframes breathe {
    0%   { box-shadow: inset 0 0 0 2px rgba(255,220,80,.85),
                       0 0  8px  3px rgba(255,200,50,.55),
                       0 0 18px  6px rgba(255,180,30,.28); }
    50%  { box-shadow: inset 0 0 0 3px rgba(255,235,100,1.0),
                       0 0 20px  9px rgba(255,210,60,.82),
                       0 0 38px 15px rgba(255,170,20,.46); }
    100% { box-shadow: inset 0 0 0 2px rgba(255,220,80,.85),
                       0 0  8px  3px rgba(255,200,50,.55),
                       0 0 18px  6px rgba(255,180,30,.28); }
}
.cell-selected {
    animation: breathe 1.1s ease-in-out infinite;
    z-index: 2;
}

.cell-last-from::before,
.cell-last-to::before {
    content: "";
    position: absolute;
    inset: 0;
    border: 3px solid rgba(135,206,235,0.9);
    box-shadow: inset 0 0 0 2px rgba(255,255,255,0.25),
                0 0 8px rgba(135,206,235,0.5);
    pointer-events: none;
    z-index: 6;
}

.cell-legal { cursor: pointer; }
.cell-legal::after {
    content: "";
    position: absolute;
    width: 32%; height: 32%;
    background: rgba(39,174,96,.78);
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,.55);
    box-shadow: 0 2px 6px rgba(0,0,0,.4);
    pointer-events: none;
    z-index: 4;
}
.cell-capture { cursor: pointer; }
.cell-capture::after {
    content: "";
    position: absolute;
    inset: 5%;
    border-radius: 50%;
    border: 4px solid rgba(231,76,60,.82);
    box-shadow: 0 0 8px rgba(231,76,60,.5);
    pointer-events: none;
    z-index: 4;
}
.cell-check { background: rgba(231,76,60,.52) !important; }

.board-coords {
    display: flex;
    justify-content: space-around;
    padding: 10px 8px 0;
    font-size: .7rem;
    color: #5a3d10;
    letter-spacing: .06em;
    width: 100%;
    max-width: 920px;
}

.demo-buttons-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    width: 100%;
    max-width: 560px;
}
.demo-piece-btn {
    background: #c7a46b;
    border: none;
    padding: 10px 16px;
    border-radius: 50px;
    font-weight: bold;
    border-bottom: 4px solid #6b4f2b;
    cursor: pointer;
    box-shadow: 0 5px 0 #4d3a1e;
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    gap: 1px;
    transition: .05s;
    color: #23200c;
    min-width: 68px;
}
.demo-piece-btn:active { transform: translateY(4px); border-bottom-width: 1px; box-shadow: 0 1px 0 #4d3a1e; }
.demo-piece-btn .piece-icon { font-size: 1.8rem; line-height: 1; }
.demo-piece-btn .lbl-zh { font-size: .95rem; font-family: 'Georgia',serif; }
.demo-piece-btn .lbl-en { font-size: .65rem; color: #5a3d10; letter-spacing: .04em; }

/* â”€â”€ Piece rendering â”€â”€ */
.piece-white {
    display: inline-block;
    position: relative;
    z-index: 5;
    line-height: 1;
    cursor: inherit;
    pointer-events: none;
    transition: color .3s, text-shadow .3s, filter .3s, -webkit-text-stroke .3s;
}
.piece-white.style-a {
    color: #d6cdb8;
    -webkit-text-stroke: 0px transparent;
    paint-order: fill;
    filter: drop-shadow(0 2px 3px rgba(0,0,0,.5));
    transform: translateY(-1px);
    text-shadow: 0 1px 0 rgba(255,255,255,.6), 0 2px 4px rgba(0,0,0,.5), 1px 3px 6px rgba(0,0,0,.4);
}
.piece-white.style-b {
    color: #f0eeff;
    -webkit-text-stroke: 0px transparent;
    paint-order: fill;
    filter: drop-shadow(0 0 4px rgba(140,100,255,.65)) drop-shadow(0 2px 3px rgba(0,0,0,.55));
    transform: translateY(-1px);
    text-shadow: 0 0 6px rgba(140,100,255,.9), 0 0 14px rgba(100,140,255,.7), 0 0 26px rgba(120,100,255,.4), 0 2px 4px rgba(0,0,0,.6), 1px 3px 5px rgba(0,0,0,.5);
}
.piece-white.style-c {
    color: #fdf6e3;
    -webkit-text-stroke: 1.4px #c8960a;
    paint-order: stroke fill;
    filter: drop-shadow(0 -1px 0 rgba(255,240,180,.5)) drop-shadow(1px 3px 2px rgba(0,0,0,.55));
    transform: scale(1.04) translateY(-1px);
    text-shadow: 0 -1px 0 rgba(255,255,255,.9), 0 1px 1px rgba(120,80,0,.5), 1px 3px 4px rgba(0,0,0,.55), 0 0 8px rgba(255,210,80,.18);
}
.piece-black {
    display: inline-block;
    position: relative;
    z-index: 5;
    line-height: 1;
    color: #1a1008;
    text-shadow: 0 1px 0 rgba(255,200,100,.12), 1px 3px 3px rgba(0,0,0,.8);
    cursor: inherit;
    pointer-events: none;
}

/* â”€â”€ Right panel â”€â”€ */
.right-panel {
    width: 240px;
    flex-shrink: 0;
    background: linear-gradient(145deg,#1f3d31,#143129);
    padding: 22px 14px;
    color: #efebd3;
    border-left: 4px solid #c1974f;
    display: none;
    flex-direction: column;
    gap: 14px;
}

.info-card {
    background: #1f332b;
    border-radius: 22px;
    padding: 14px 12px;
    border: 2px solid #c8a45c;
    text-align: center;
}
.info-card h3 { font-size: .95rem; color: #e9d59a; margin-bottom: 8px; }
#game-status {
    font-size: 1.1rem;
    font-weight: bold;
    background: #2e4d3e;
    padding: 8px 10px;
    border-radius: 28px;
    line-height: 1.45;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color .3s;
}

.move-log-wrap {
    background: #1f332b;
    border-radius: 22px;
    padding: 12px;
    border: 2px solid #c8a45c;
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 140px;
}
.move-log-wrap h3 { font-size: .95rem; color: #e9d59a; margin-bottom: 6px; }
#move-log {
    overflow-y: auto;
    flex: 1;
    font-size: .8rem;
    color: #c9b98a;
    line-height: 1.75;
    font-family: 'Courier New',monospace;
}
#move-log::-webkit-scrollbar { width: 4px; }
#move-log::-webkit-scrollbar-thumb { background: #c8a45c55; border-radius: 4px; }

.captured-row {
    background: #1f332b;
    border-radius: 22px;
    padding: 10px 12px;
    border: 2px solid #c8a45c;
}
.captured-row h3 { font-size: .88rem; color: #e9d59a; margin-bottom: 5px; }
#captured-white, #captured-black {
    font-size: 1.2rem;
    min-height: 26px;
    word-break: break-word;
    line-height: 1.3;
}
.cap-label { font-size: .68rem; color: #8aaa90; margin-bottom: 2px; }

.action-btn {
    border: none;
    padding: 11px;
    border-radius: 32px;
    font-weight: bold;
    font-size: .95rem;
    cursor: pointer;
    transition: .08s;
    letter-spacing: .5px;
}
.action-btn:active { transform: translateY(3px); }
#resetBtn { background:#ad7e4e; color:#211d0e; border-bottom:5px solid #5b431f; box-shadow:0 6px 0 #3f301b; }
#undoBtn  { background:#6b9e78; color:#112218; border-bottom:5px solid #3a5e44; box-shadow:0 6px 0 #2a4432; }

/* Promotion picker */
#promotionPicker {
    background: #2e4d3e;
    border: 3px solid #c8a45c;
    border-radius: 20px;
    padding: 10px 18px;
    display: flex;
    gap: 14px;
    align-items: center;
}
.promo-btn {
    font-size: 2rem;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 10px;
    background: rgba(201,168,76,.12);
    border: 1px solid #c8a45c;
    transition: .1s;
    line-height: 1;
}
.promo-btn:hover { background: rgba(201,168,76,.38); transform: scale(1.1); }

.h3-en {
    display: block;
    font-size: .6rem;
    font-weight: 500;
    letter-spacing: .1em;
    color: #8aaa90;
    font-family: 'Segoe UI', sans-serif;
    margin-top: 1px;
}
.info-card h3, .move-log-wrap h3, .captured-row h3 {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1px;
}
.cap-en {
    font-size: .6rem;
    color: #6a8870;
    letter-spacing: .06em;
    font-family: 'Segoe UI', sans-serif;
}
.action-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}
.action-btn .btn-zh  { font-size: 1rem; }
.action-btn .btn-en-action {
    font-size: .62rem;
    font-family: 'Segoe UI', sans-serif;
    font-weight: 600;
    letter-spacing: .07em;
    opacity: .68;
}

/* â”€â”€ Style picker widget â”€â”€ */
.style-picker {
    width: 100%;
    background: rgba(0,0,0,.25);
    border: 2px solid #7a6040;
    border-radius: 28px;
    padding: 12px 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}
.style-picker-label {
    font-size: .68rem;
    letter-spacing: .1em;
    text-transform: uppercase;
    color: #c8a45c;
    font-family: 'Segoe UI', sans-serif;
    font-weight: 700;
}
.style-picker-sublabel {
    font-size: .58rem;
    color: #7a9a82;
    letter-spacing: .05em;
    margin-top: -4px;
}
.style-options {
    display: flex;
    flex-direction: column;
    gap: 6px;
    width: 100%;
}
.style-opt {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 10px;
    border-radius: 20px;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all .15s;
    background: transparent;
    width: 100%;
    text-align: left;
}
.style-opt:hover { background: rgba(255,255,255,.06); border-color: #7a6040; }
.style-opt.selected { background: rgba(201,168,76,.15); border-color: #c8a45c; }
.style-opt input[type=radio] { display: none; }
.style-opt-preview {
    font-size: 1.4rem;
    line-height: 1;
    width: 28px;
    text-align: center;
    flex-shrink: 0;
}
.style-opt-preview.style-a {
    color: #d6cdb8;
    filter: drop-shadow(0 2px 3px rgba(0,0,0,.5));
    text-shadow: 0 1px 0 rgba(255,255,255,.6), 0 2px 4px rgba(0,0,0,.5);
}
.style-opt-preview.style-b {
    color: #f0eeff;
    filter: drop-shadow(0 0 4px rgba(140,100,255,.65));
    text-shadow: 0 0 6px rgba(140,100,255,.9), 0 0 14px rgba(100,140,255,.6);
}
.style-opt-preview.style-c {
    color: #fdf6e3;
    -webkit-text-stroke: 1.2px #c8960a;
    paint-order: stroke fill;
    filter: drop-shadow(1px 3px 2px rgba(0,0,0,.5));
    text-shadow: 0 -1px 0 rgba(255,255,255,.8), 1px 3px 3px rgba(0,0,0,.5);
}
.style-opt-text {
    display: flex;
    flex-direction: column;
    gap: 1px;
}
.style-opt-name {
    font-size: .78rem;
    font-weight: 700;
    color: #e8d9b0;
    font-family: 'Georgia', serif;
}
.style-opt-desc {
    font-size: .58rem;
    color: #7a9a82;
    letter-spacing: .04em;
    font-family: 'Segoe UI', sans-serif;
}
.style-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    margin-left: auto;
    flex-shrink: 0;
    background: transparent;
    border: 1.5px solid #7a6040;
    transition: all .15s;
}
.style-opt.selected .style-dot { background: #c8a45c; border-color: #c8a45c; box-shadow: 0 0 6px rgba(200,164,92,.6); }

.hidden { display: none !important; }

.mini-ad {
    margin-top: 6px;
    text-align: center;
    opacity: 0.6;
    color: rgba(201,168,76,.55);
}
.mini-ad-title { font-size: 12px; font-weight: 500; margin: 2px 0; }
.mini-ad-sub { font-size: 10px; letter-spacing: 0.5px; margin: 0; }

/* â”€â”€ Insight View â”€â”€ */
/* â”€â”€ Insight View Styles â”€â”€ */
.insight-view {
    width: 100%;
    max-width: 850px;
    height: 100%;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 30px;
    padding: 30px;
    overflow-y: auto;
    color: #3a2e10;
    line-height: 1.8;
}
.insight-view::-webkit-scrollbar { width: 6px; }
.insight-view::-webkit-scrollbar-thumb { background: #c8a45c; border-radius: 10px; }
.insight-header h2 { text-align: center; color: #5f3f1a; font-size: 1.8rem; margin-bottom: 25px; border-bottom: 2px dashed #c8a45c; padding-bottom: 10px; }
.insight-section { margin-bottom: 25px; background: rgba(255,255,255,0.3); padding: 15px; border-radius: 15px; border-left: 5px solid #c8a45c; }
.insight-section h3 { color: #1d3e2f; font-size: 1.2rem; margin-bottom: 10px; }
.insight-quote { font-style: italic; color: #5f3f1a; margin-top: 10px; font-weight: bold; background: rgba(212, 161, 94, 0.1); padding: 8px; border-radius: 5px; }
.insight-footer { text-align: center; margin-top: 20px; }

.restart-btn-large {
    background: linear-gradient(135deg, #c8a45c, #e8c47c);
    border: none;
    padding: 14px 32px;
    border-radius: 40px;
    font-size: 1rem;
    font-family: 'Georgia', serif;
    font-weight: 700;
    color: #1f2e1a;
    cursor: pointer;
    border-bottom: 5px solid #7b5a2c;
    box-shadow: 0 8px 0 #4a3518, 0 12px 20px rgba(0,0,0,.35);
    transition: .08s;
    letter-spacing: .04em;
}
.restart-btn-large:hover { background: linear-gradient(135deg, #d4b46c, #f0d48c); }
.restart-btn-large:active { transform: translateY(5px); border-bottom-width: 2px; box-shadow: 0 2px 0 #4a3518; }

</style>
</head>
<body>

<div class="main-layout">

  <!-- LEFT -->
  <div class="left-panel">
    <div class="cocobo-logo">
      <span class="logo-main">COCOBO</span>
      <span class="logo-sub">CHESS LAB</span>
    </div>
    <button class="mode-btn active" id="btnDemo">
      <span class="btn-zh">ğŸ§© åŸºæœ¬èµ°æ³•æ¼”ç¤º</span>
      <span class="btn-en">DEMO</span>
    </button>
    <button class="mode-btn" id="btnGame">
      <span class="btn-zh">âš”ï¸ å¼€å§‹æ¯”èµ›</span>
      <span class="btn-en">Start Match</span>
    </button>

    <!-- White piece style picker -->
    <div class="style-picker" id="stylePicker">
      <div class="style-picker-label">ç™½æ£‹é£æ ¼</div>
      <div class="style-picker-sublabel"></div>
      <div class="style-options">

        <label class="style-opt" data-style="a">
          <input type="radio" name="pieceStyle" value="a">
          <span class="style-opt-preview style-a">â™”</span>
          <div class="style-opt-text">
            <span class="style-opt-name">æ–¹æ¡ˆ A</span>
            <span class="style-opt-desc">æš—è±¡ç‰™ Â· Dark Ivory</span>
          </div>
          <span class="style-dot"></span>
        </label>

        <label class="style-opt selected" data-style="b">
          <input type="radio" name="pieceStyle" value="b" checked>
          <span class="style-opt-preview style-b">â™”</span>
          <div class="style-opt-text">
            <span class="style-opt-name">æ–¹æ¡ˆ B âœ¦</span>
            <span class="style-opt-desc">ç´«è“å…‰æ™• Â· Blue Glow</span>
          </div>
          <span class="style-dot"></span>
        </label>

        <label class="style-opt" data-style="c">
          <input type="radio" name="pieceStyle" value="c">
          <span class="style-opt-preview style-c">â™”</span>
          <div class="style-opt-text">
            <span class="style-opt-name">æ–¹æ¡ˆ C</span>
            <span class="style-opt-desc">é‡‘è¾¹è±¡ç‰™ Â· Gold Stroke</span>
          </div>
          <span class="style-dot"></span>
        </label>

      </div>
    </div>

    <div class="mini-ad">
        <p class="mini-ad-title">Chess Shapes Thinking.</p>
        <p class="mini-ad-sub">
            AI Â· Mathematics Â· Logic Modeling Â· Psychology Â· Strategic Thinking
        </p>
        <p class="mini-ad-sub">
            COCOBO.TECH.CHESS
        </p>
    </div>
    
    <button class="mode-btn" id="btnInsight" style="box-shadow: 0 4px 0 #3f321e, 0 5px 10px black; padding: 10px 5px;">
      <span class="btn-zh">âœ¨ğŸŒæ„Ÿæ‚ŸğŸŒâœ¨</span>
      <span class="btn-en">INSIGHTS</span>
    </button>

  </div>

  <!-- CENTER -->
  <div class="center-panel">

    <!-- Board (shown in demo/game mode) -->
    <div id="boardArea">
      <div class="chess-board-shell">
        <div class="custom-board" id="mainBoard"></div>
      </div>
      <div class="board-coords">
        <span>a</span><span>b</span><span>c</span><span>d</span>
        <span>e</span><span>f</span><span>g</span><span>h</span>
      </div>
      <div class="demo-buttons-row" id="demoButtons"></div>
      <div id="promotionPicker" class="hidden" style="background:#2e4d3e;border:3px solid #c8a45c;border-radius:20px;padding:10px 18px;display:flex;gap:14px;align-items:center;">
        <span style="color:#e9d59a;font-size:.85rem;">å…µå‡å˜<br><span style="font-size:.7rem;opacity:.7;">Promotion</span></span>
        <span class="promo-btn" data-p="q">â™•</span>
        <span class="promo-btn" data-p="r">â™–</span>
        <span class="promo-btn" data-p="b">â™—</span>
        <span class="promo-btn" data-p="n">â™˜</span>
      </div>
    </div>

    <!-- Insight View (hidden by default) -->
    <div id="insightView" class="insight-view hidden">

      <div class="insight-header">
        <!--<h2>äººç”Ÿå¦‚æ£‹ Â· æ£‹å¦‚äººç”Ÿ</h2>-->
       
      </div>

      <div class="insight-section">
        <h3>1ï¸âƒ£ äººç”Ÿä¸æ˜¯ä¹±èµ°ï¼Œæ˜¯æœ‰è®¡åˆ’</h3>
        <div class="insight-content">
          <p>æ£‹ç›˜ä¸Šçš„æ¯ä¸€é¢—å­ï¼Œéƒ½æœ‰å…¶å­˜åœ¨çš„æ„ä¹‰ã€‚äººç”Ÿäº¦å¦‚æ£‹å±€ï¼Œè‰ç‡çš„è½å­å¾€å¾€ä¼šå¯¼è‡´å…¨å±€çš„è¢«åŠ¨ã€‚</p>
          <div class="insight-quote">æ®·å‹¤ç­¹åˆ’çš„ï¼Œè¶³è‡´ä¸°è£•ï¼›è¡Œäº‹æ€¥èºçš„ï¼Œéƒ½å¿…ç¼ºä¹ã€‚   ---ç®´è¨€ 21:5</div>
        </div>
      </div>

      <div class="insight-section">
        <h3>2ï¸âƒ£ Pawn çš„æˆé•¿ï¼šä»å¾®å°åˆ°å“è¶Š</h3>
        <div class="insight-content">
          <p><strong>Pawn èµ°åˆ°åº•ï¼Œç»ˆä¼šå˜ Queenã€‚</strong></p>
          <p>æ–°ç”Ÿå‘½çš„æˆé•¿ã€‚ä»å¹¼å«©åˆ°æˆç†Ÿï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯åœ¨é è¿‘é‚£ä¸ªè¢«å‘½å®šçš„ä¸°ç››ã€‚</p>
          <div class="insight-quote">ä¹‰äººçš„è·¯å¥½åƒé»æ˜çš„å…‰ï¼Œ è¶Šç…§è¶Šæ˜ï¼Œç›´åˆ°æ—¥åˆã€‚   ---ç®´è¨€ 4:18 </div>
        </div>
      </div>

      <div class="insight-section">
        <h3>3ï¸âƒ£ é»‘ç™½äº¤ç»‡ï¼šå…‰çš„å¾—èƒœ</h3>
        <div class="insight-content">
          <p>æ£‹å±€ç±»æ¯”ï¼š<strong>ç™½æ£‹ vs é»‘æ£‹ = å…‰æ˜ vs é»‘æš—</strong>ã€‚</p>
          <p>æ£‹å±€ä¸­å……æ»¡äº†åšå¼ˆã€‚é»‘æš—è™½ç„¶å­˜åœ¨ï¼Œä½†å…‰æ€»æ˜¯åœ¨å¯»æ‰¾ç ´å±€çš„æœºä¼šã€‚</p>
          <div class="insight-quote"> å…‰ç…§åœ¨é»‘æš—é‡Œï¼Œé»‘æš—å´æ²¡æœ‰èƒœè¿‡å…‰    ---çº¦ç¿°ç¦éŸ³ 1:5</div>
        </div>
      </div>

      <div class="insight-section">
        <h3>4ï¸âƒ£ è¾“äº†æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å†æ¥ä¸€æ¬¡</h3>
        <div class="insight-content">
          <p>åœ¨æ£‹å±€ä¸­ï¼Œå¤±è´¥æ˜¯å­¦ä¹ çš„å¿…ç»ä¹‹è·¯ã€‚åœ¨äººç”Ÿä¸­ï¼Œè·Œå€’å¹¶ä¸æ˜¯ç»ˆç‚¹ã€‚</p>
          <div class="insight-quote"> ä¹‰äººè™½ä¸ƒæ¬¡è·Œå€’ï¼Œä»å¿…å…´èµ·    ---ç®´è¨€ 24:16 </div>
        </div>
      </div>

      <div class="insight-footer">
        <button class="restart-btn-large" id="insightStartBtn">
          æ”¶æ‹¾å¿ƒæƒ… Â· å¼€å¯æ–°å±€ â™Ÿ
        </button>
      </div>

    </div>

  </div>

  <!-- RIGHT -->
  <div class="right-panel" id="rightPanel">
    <div class="info-card">
      <h3>â™Ÿ å¯¹å±€çŠ¶æ€ <span class="h3-en">Game Status</span></h3>
      <div id="game-status">âšª ç™½æ–¹å…ˆè¡Œ</div>
    </div>
    <div class="move-log-wrap">
      <h3>ğŸ“‹ èµ°æ£‹è®°å½• <span class="h3-en">Log</span></h3>
      <div id="move-log"></div>
    </div>
    <div class="captured-row">
    <h3>ğŸ“¦ è¢«åƒæ£‹å­ <span class="h3-en">Captured</span></h3>
    <div class="cap-label">âšª ç™½æ–¹å¾—å­ <span class="cap-en">White captures</span></div>
    <div id="captured-black"></div> <!-- è¿™é‡Œæ˜¾ç¤ºç™½æ£‹åƒæ‰çš„é»‘å­ -->
    
    <div class="cap-label" style="margin-top:5px;">âš« é»‘æ–¹å¾—å­ <span class="cap-en">Black captures</span></div>
    <div id="captured-white"></div> <!-- è¿™é‡Œæ˜¾ç¤ºé»‘æ£‹åƒæ‰çš„ç™½å­ -->
    </div>
    <button class="action-btn" id="undoBtn">
      <span class="btn-zh">â†© æ‚”æ£‹</span>
      <span class="btn-en-action">Undo</span>
    </button>
    <button class="action-btn" id="resetBtn">
      <span class="btn-zh">ğŸ”„ é‡æ–°å¼€å±€</span>
      <span class="btn-en-action">New Game</span>
    </button>
  </div>

</div>

<!-- Footer -->
<footer style="
    width:100%;
    text-align:center;
    padding: 14px 20px;
    font-family: 'Segoe UI', sans-serif;
    font-size: .72rem;
    letter-spacing: .14em;
    color: rgba(201,168,76,.55);
    text-transform: uppercase;
    user-select: none;
    flex-shrink: 0;
">
  COCOBO-TECH &nbsp;|&nbsp; Â© 2026 COCOBO
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

<script>
/* â”€â”€ White piece style state â”€â”€ */
let currentStyle = 'b';

function applyStyleToEl(el, isWhite) {
    if (!isWhite) return;
    el.classList.remove('style-a', 'style-b', 'style-c');
    el.classList.add('style-' + currentStyle);
}

document.querySelectorAll('.style-opt').forEach(opt => {
    opt.addEventListener('click', () => {
        const s = opt.dataset.style;
        currentStyle = s;
        document.querySelectorAll('.style-opt').forEach(o => o.classList.remove('selected'));
        opt.classList.add('selected');
        
        // --- ä¿®å¤ç‚¹ï¼šæ ¹æ®å½“å‰æ¨¡å¼é€‰æ‹©æ¸²æŸ“å‡½æ•° ---
        const isDemo = document.getElementById('btnDemo').classList.contains('active');
        if (isDemo) {
            // å°è¯•è·å–å½“å‰æ¼”ç¤ºçš„æ£‹å­ç±»å‹ï¼Œé»˜è®¤ç”¨ king
            renderDemoBoard('king'); 
        } else {
            renderGameBoard();
        }
    });
});
/* â”€â”€ Audio engine â”€â”€ */
const AC = new (window.AudioContext || window.webkitAudioContext)();

function playTone(opts) {
    const { freq=440, freq2=freq, type='sine', gain=0.18,
            attack=0.004, decay=0.08, sustain=0.04, release=0.12,
            duration=0.28, detune=0 } = opts;
    const osc  = AC.createOscillator();
    const osc2 = AC.createOscillator();
    const gainN = AC.createGain();
    const filter = AC.createBiquadFilter();
    filter.type = 'bandpass';
    filter.frequency.value = freq * 2.5;
    filter.Q.value = 1.2;
    osc.type  = type; osc2.type = type;
    osc.frequency.setValueAtTime(freq, AC.currentTime);
    osc2.frequency.setValueAtTime(freq2, AC.currentTime);
    osc.detune.value  = detune; osc2.detune.value = detune + 6;
    const t = AC.currentTime;
    gainN.gain.setValueAtTime(0, t);
    gainN.gain.linearRampToValueAtTime(gain, t + attack);
    gainN.gain.setValueAtTime(gain, t + attack + sustain);
    gainN.gain.exponentialRampToValueAtTime(0.0001, t + attack + sustain + release);
    osc.connect(filter); osc2.connect(filter);
    filter.connect(gainN); gainN.connect(AC.destination);
    osc.start(t); osc2.start(t);
    osc.stop(t + duration); osc2.stop(t + duration);
}

function soundMove() {
    playTone({ freq:1480, freq2:1520, type:'triangle', gain:0.22, attack:0.002, decay:0.01, sustain:0.00, release:0.08, duration:0.12 });
    setTimeout(()=>{ playTone({ freq:880, freq2:900, type:'sine', gain:0.12, attack:0.003, decay:0.01, sustain:0.01, release:0.10, duration:0.14 }); }, 8);
}
function soundCapture() {
    playTone({ freq:1760, freq2:1800, type:'sawtooth', gain:0.16, attack:0.001, decay:0.005, sustain:0.00, release:0.07, duration:0.10 });
    setTimeout(()=>{ playTone({ freq:440, type:'triangle', gain:0.20, attack:0.003, decay:0.02, sustain:0.01, release:0.14, duration:0.18 }); }, 10);
}
function soundCheck() {
    [0, 90, 180].forEach((delay, i) => {
        setTimeout(()=>{ playTone({ freq: 1318 + i*110, type:'sine', gain:0.18, attack:0.003, sustain:0.02, release:0.13, duration:0.18 }); }, delay);
    });
}
function soundCheckmate() {
    [523, 440, 370, 294].forEach((f, i) => {
        setTimeout(()=>{ playTone({ freq:f, type:'sine', gain:0.20, attack:0.01, sustain:0.08, release:0.22, duration:0.35 }); }, i * 160);
    });
}
function soundCastle() {
    [0, 110].forEach(d => {
        setTimeout(()=>{ playTone({ freq:1200, type:'triangle', gain:0.18, attack:0.002, sustain:0.01, release:0.09, duration:0.13 }); }, d);
    });
}
function soundPromotion() {
    [784, 1047, 1319, 1568].forEach((f, i) => {
        setTimeout(()=>{ playTone({ freq:f, type:'sine', gain:0.15, attack:0.005, sustain:0.03, release:0.12, duration:0.18 }); }, i * 70);
    });
}
function soundIllegal() {
    playTone({ freq:220, type:'sawtooth', gain:0.08, attack:0.004, sustain:0.02, release:0.10, duration:0.15 });
}

document.addEventListener('click', () => { if(AC.state==='suspended') AC.resume(); }, {once:true});

/* â”€â”€ Glyphs â”€â”€ */
const GLYPH = {
    wK:'â™”', wQ:'â™•', wR:'â™–', wB:'â™—', wN:'â™˜', wP:'â™™',
    bK:'â™š', bQ:'â™›', bR:'â™œ', bB:'â™', bN:'â™', bP:'â™Ÿ'
};
function glyphOf(piece) {
    if(!piece) return '';
    return GLYPH[(piece.color==='w'?'w':'b') + piece.type.toUpperCase()] || '';
}

/* â”€â”€ DEMO MODE â”€â”€ */
const DEMO_SYMBOLS = { king:'â™”', queen:'â™•', rook:'â™–', bishop:'â™—', knight:'â™˜', pawn:'â™™' };
const DEMO_LABELS  = {
    king:{zh:'ç‹',en:'King'}, queen:{zh:'å',en:'Queen'},
    rook:{zh:'è½¦',en:'Rook'}, bishop:{zh:'è±¡',en:'Bishop'},
    knight:{zh:'é©¬',en:'Knight'}, pawn:{zh:'å…µ',en:'Pawn'}
};
const DEMO_POS = {
    king:{row:4,col:4}, queen:{row:4,col:3}, rook:{row:4,col:2},
    bishop:{row:3,col:3}, knight:{row:4,col:3},
    pawn:{row:3,col:6}
};

function demoSlide(r,c,dirs) {
    const m=[];
    for(const [dr,dc] of dirs)
        for(let s=1;s<8;s++){
            const nr=r+dr*s,nc=c+dc*s;
            if(nr<0||nr>=8||nc<0||nc>=8) break;
            m.push({row:nr,col:nc});
        }
    return m;
}
const DEMO_MOVES = {
    king(r,c)   { const m=[];for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++)if(dr||dc){const nr=r+dr,nc=c+dc;if(nr>=0&&nr<8&&nc>=0&&nc<8)m.push({row:nr,col:nc});}return{move:m,capture:[]}; },
    queen(r,c)  { return{move:demoSlide(r,c,[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]]),capture:[]}; },
    rook(r,c)   { return{move:demoSlide(r,c,[[-1,0],[1,0],[0,-1],[0,1]]),capture:[]}; },
    bishop(r,c) { return{move:demoSlide(r,c,[[-1,-1],[-1,1],[1,-1],[1,1]]),capture:[]}; },
    knight(r,c) { const j=[[-2,-1],[-2,1],[2,-1],[2,1],[-1,-2],[-1,2],[1,-2],[1,2]],m=[];for(const [dr,dc] of j){const nr=r+dr,nc=c+dc;if(nr>=0&&nr<8&&nc>=0&&nc<8)m.push({row:nr,col:nc});}return{move:m,capture:[]}; },
    pawn(r,c)   {
        const move=[], capture=[];
        if(r-1>=0) move.push({row:r-1,col:c});
        if(r===6 && r-2>=0) move.push({row:r-2,col:c});
        if(r-1>=0 && c-1>=0) capture.push({row:r-1,col:c-1});
        if(r-1>=0 && c+1<8) capture.push({row:r-1,col:c+1});
        return {move, capture};
    }
};

function renderDemoBoard(type) {
    const board = document.getElementById('mainBoard');
    board.innerHTML = '';
    board.style.cursor = 'default';
    const pos = DEMO_POS[type];
    const mainPath = DEMO_MOVES[type](pos.row, pos.col);
    const pawn2 = (type === 'pawn') ? {row:6, col:1} : null;
    const subPath = pawn2 ? DEMO_MOVES.pawn(pawn2.row, pawn2.col) : {move:[], capture:[]};

    for(let r=0;r<8;r++) for(let c=0;c<8;c++) {
        const cell = document.createElement('div');
        cell.className = `custom-cell ${(r+c)%2===0?'custom-light':'custom-dark'}`;
        if((r===pos.row && c===pos.col) || (pawn2 && r===pawn2.row && c===pawn2.col)) {
            const sp = document.createElement('span');
            sp.className = 'piece-white style-' + currentStyle;
            sp.textContent = type !== 'pawn' ? DEMO_SYMBOLS[type] : 'â™™';
            cell.appendChild(sp);
        }
        const isCapture = mainPath.capture.some(p=>p.row===r&&p.col===c) ||
                          subPath.capture.some(p=>p.row===r&&p.col===c);
        if(isCapture) {
            const enemy = document.createElement('span');
            enemy.className = 'piece-black';
            enemy.textContent = (r+c)%2===0 ? 'â™' : 'â™Ÿ';
            cell.appendChild(enemy);
            cell.classList.add('capture-arrow');
        } else if(mainPath.move.some(p=>p.row===r&&p.col===c) ||
                  subPath.move.some(p=>p.row===r&&p.col===c)) {
            cell.classList.add('move-dot');
        }
        board.appendChild(cell);
    }
}

const demoButtonsDiv = document.getElementById('demoButtons');
['king','queen','rook','bishop','knight','pawn'].forEach(type => {
    const btn = document.createElement('button');
    btn.className = 'demo-piece-btn';
    btn.innerHTML = `
        <span class="piece-icon">${DEMO_SYMBOLS[type]}</span>
        <span class="lbl-zh">${DEMO_LABELS[type].zh}</span>
        <span class="lbl-en">${DEMO_LABELS[type].en}</span>`;
    btn.addEventListener('click', () => renderDemoBoard(type));
    demoButtonsDiv.appendChild(btn);
});

/* â”€â”€ GAME MODE â”€â”€ */
let chess = null;
let selectedSq   = null;
let legalTargets = [];
let lastMove     = null;
let pendingPromo = null;
let moveCount    = 0;
let capturedByWhite = [];
let capturedByBlack = [];
const PIECE_VALUES = {p:1,n:3,b:3,r:5,q:9,k:0};

function sqToGrid(sq) { return { row: 8 - parseInt(sq[1]), col: sq.charCodeAt(0)-97 }; }
function gridToSq(row,col) { return String.fromCharCode(97+col) + (8-row); }
function findKingSq(color) {
    const b=chess.board();
    for(let r=0;r<8;r++) for(let c=0;c<8;c++){
        const p=b[r][c];
        if(p&&p.type==='k'&&p.color===color) return gridToSq(r,c);
    }
    return null;
}

function renderGameBoard() {
    const boardEl = document.getElementById('mainBoard');
    boardEl.innerHTML = '';
    const kingCheckSq = chess.in_check() ? findKingSq(chess.turn()) : null;

    for(let r=0;r<8;r++) for(let c=0;c<8;c++) {
        const sq = gridToSq(r,c);
        const cell = document.createElement('div');
        cell.className = `custom-cell ${(r+c)%2===0?'custom-light':'custom-dark'}`;
        cell.dataset.sq = sq;
        if(lastMove && sq===lastMove.from) cell.classList.add('cell-last-from');
        if(lastMove && sq===lastMove.to)   cell.classList.add('cell-last-to');
        if(kingCheckSq && sq===kingCheckSq) cell.classList.add('cell-check');
        if(sq===selectedSq) cell.classList.add('cell-selected');
        const lt = legalTargets.find(t=>t.sq===sq);
        if(lt) cell.classList.add(lt.isCapture ? 'cell-capture' : 'cell-legal');
        const piece = chess.get(sq);
        if(piece) {
            const span = document.createElement('span');
            span.textContent = glyphOf(piece);
            span.className = piece.color === 'w' ? 'piece-white style-' + currentStyle : 'piece-black';
            cell.appendChild(span);
        }
        if(!chess.game_over()) {
            if((piece&&piece.color===chess.turn()) || lt) cell.style.cursor = 'pointer';
        }
        cell.addEventListener('click', onCellClick);
        boardEl.appendChild(cell);
    }
}

function onCellClick(e) {
    if(chess.game_over() || pendingPromo) return;
    if(AC.state==='suspended') AC.resume();
    const sq = e.currentTarget.dataset.sq;
    const piece = chess.get(sq);
    const lt = legalTargets.find(t=>t.sq===sq);
    if(lt) { attemptMove(selectedSq, sq); return; }
    if(piece && piece.color===chess.turn()) {
        selectedSq = sq;
        const moves = chess.moves({square:sq, verbose:true});
        legalTargets = moves.map(m=>({sq:m.to, isCapture:!!(m.captured||m.flags.includes('e'))}));
        renderGameBoard();
        return;
    }
    selectedSq = null; legalTargets = [];
    renderGameBoard();
}

function attemptMove(from, to) {
    const piece = chess.get(from);
    if(piece && piece.type==='p' &&
       ((piece.color==='w'&&to[1]==='8')||(piece.color==='b'&&to[1]==='1'))) {
        pendingPromo = {from, to};
        selectedSq=null; legalTargets=[];
        renderGameBoard();
        showPromotion(piece.color);
        return;
    }
    executeMove(from, to, 'q');
}

function executeMove(from, to, promo) {
    const move = chess.move({from, to, promotion:promo});
    if(!move) { soundIllegal(); selectedSq=null; legalTargets=[]; renderGameBoard(); return; }
    lastMove = {from, to};
    selectedSq=null; legalTargets=[]; pendingPromo=null;
    document.getElementById('promotionPicker').classList.add('hidden');
    if(move.captured) {
        const capPiece={type:move.captured, color:move.color==='w'?'b':'w'};
        if(move.color==='w') capturedByWhite.push(capPiece);
        else                 capturedByBlack.push(capPiece);
    }
    const flags = move.flags || '';
    if(chess.in_checkmate())                              { soundCheckmate(); }
    else if(flags.includes('p'))                          { soundPromotion(); }
    else if(flags.includes('k')||flags.includes('q'))     { soundCastle(); }
    else if(move.captured||flags.includes('e'))           { soundCapture(); }
    else                                                  { soundMove(); }
    if(chess.in_check() && !chess.in_checkmate()) { setTimeout(soundCheck, 180); }
    logMove(move);
    updateStatus();
    updateCapturedDisplay();
    renderGameBoard();
}

function showPromotion(color) {
    const picker = document.getElementById('promotionPicker');
    picker.classList.remove('hidden');
    picker.querySelectorAll('.promo-btn').forEach(btn=>{
        const t=btn.dataset.p.toUpperCase();
        btn.textContent = GLYPH[(color==='w'?'w':'b')+t];
    });
}
document.querySelectorAll('.promo-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
        if(!pendingPromo) return;
        executeMove(pendingPromo.from, pendingPromo.to, btn.dataset.p);
    });
});

function updateStatus() {
    const el=document.getElementById('game-status');
    const turn=chess.turn();
    if(chess.in_checkmate()) {
        const winner=turn==='w'?'âš« é»‘æ–¹':'âšª ç™½æ–¹';
        el.innerHTML=`ğŸ† å°†æ­»ï¼${winner}èƒœåˆ©ï¼`;
        el.style.color='#f5c842';
    } else if(chess.in_draw()) {
        let r='å’Œæ£‹';
        if(chess.in_stalemate())                r='é€¼å’Œï¼ˆæ— å­å¯èµ°ï¼‰';
        else if(chess.insufficient_material())  r='å­åŠ›ä¸è¶³';
        else if(chess.in_threefold_repetition())r='ä¸‰æ¬¡é‡å¤';
        el.innerHTML=`ğŸ¤ ${r}`;
        el.style.color='#8cc';
    } else if(chess.in_check()) {
        const who=turn==='w'?'âšª ç™½æ–¹':'âš« é»‘æ–¹';
        el.innerHTML=`âš ï¸ å°†å†›ï¼${who}è¢«å°†å†›`;
        el.style.color='#e74c3c';
    } else {
        const who=turn==='w'?'âšª ç™½æ–¹':'âš« é»‘æ–¹';
        el.innerHTML=`${who} è¡Œæ£‹`;
        el.style.color='#efebd3';
    }
}

function logMove(move) {
    moveCount++;
    const logEl=document.getElementById('move-log');
    if(move.color==='w') {
        const row=document.createElement('div');
        row.style.cssText='display:flex;gap:6px;padding:1px 0;';
        row.id=`mr-${Math.ceil(moveCount/2)}`;
        const num=document.createElement('span');
        num.style.color='#c8a45c'; num.style.minWidth='22px';
        num.textContent=`${Math.ceil(moveCount/2)}.`;
        const ws=document.createElement('span');
        ws.style.minWidth='58px'; ws.textContent=move.san;
        row.appendChild(num); row.appendChild(ws);
        logEl.appendChild(row);
    } else {
        const row=document.getElementById(`mr-${Math.ceil(moveCount/2)}`);
        if(row){ const bs=document.createElement('span'); bs.style.color='#aac'; bs.textContent=move.san; row.appendChild(bs); }
    }
    logEl.scrollTop=logEl.scrollHeight;
}

function updateCapturedDisplay() {
    const sort = arr => [...arr].sort((a, b) => PIECE_VALUES[b.type] - PIECE_VALUES[a.type]);
    
    // --- ä¿®å¤ç‚¹ï¼šç¡®ä¿â€œç™½åƒé»‘â€æ˜¾ç¤ºåœ¨æ­£ç¡®çš„ ID ä¸‹ ---
    // ä¹‹å‰ä½ çš„ HTML ID å’Œ å˜é‡é€»è¾‘æ˜¯æ‰“æ¶çš„
    document.getElementById('captured-black').textContent = sort(capturedByWhite).map(p => glyphOf(p)).join(' ');
    document.getElementById('captured-white').textContent = sort(capturedByBlack).map(p => glyphOf(p)).join(' ');
}

document.getElementById('undoBtn').addEventListener('click',()=>{
    if(!chess||chess.game_over()) return;
    const move=chess.undo();
    if(!move) return;
    moveCount--;
    if(move.captured){ if(move.color==='w') capturedByWhite.pop(); else capturedByBlack.pop(); }
    const rowId=`mr-${Math.ceil((moveCount+1)/2)}`;
    const row=document.getElementById(rowId);
    if(row){
        if(move.color==='b'){ const spans=row.querySelectorAll('span'); if(spans.length>2)spans[spans.length-1].remove(); }
        else row.remove();
    }
    lastMove=null;
    const hist=chess.history({verbose:true});
    if(hist.length>0){ const p=hist[hist.length-1]; lastMove={from:p.from,to:p.to}; }
    selectedSq=null; legalTargets=[];
    soundMove();
    updateStatus(); updateCapturedDisplay(); renderGameBoard();
});

document.getElementById('resetBtn').addEventListener('click', initGame);

function initGame() {
    chess=new Chess();
    selectedSq=null; legalTargets=[]; lastMove=null; pendingPromo=null;
    moveCount=0; capturedByWhite=[]; capturedByBlack=[];
    document.getElementById('move-log').innerHTML='';
    document.getElementById('promotionPicker').classList.add('hidden');
    document.getElementById('game-status').style.color='#efebd3';
    updateStatus(); updateCapturedDisplay(); renderGameBoard();
}

/* â”€â”€ MODE SWITCH â”€â”€ */
const rightPanel    = document.getElementById('rightPanel');
const btnDemo       = document.getElementById('btnDemo');
const btnGame       = document.getElementById('btnGame');
const btnInsight    = document.getElementById('btnInsight');
const boardArea     = document.getElementById('boardArea');
const insightView   = document.getElementById('insightView');

function setMode(mode) {
    // Update button active states
    btnDemo.classList.toggle('active',    mode === 'demo');
    btnGame.classList.toggle('active',    mode === 'game');
    btnInsight.classList.toggle('active', mode === 'insight');

    // Show/hide board area
    boardArea.classList.toggle('hidden', mode === 'insight');
    // Show/hide insight view
    insightView.classList.toggle('hidden', mode !== 'insight');
    // Show/hide right panel
    rightPanel.style.display = (mode === 'game') ? 'flex' : 'none';
    // Hide demo button row when in game
    demoButtonsDiv.classList.toggle('hidden', mode === 'game');
    // Hide promotion picker when switching
    document.getElementById('promotionPicker').classList.add('hidden');

    if (mode === 'demo') {
        renderDemoBoard('king');
    } else if (mode === 'game') {
        initGame();
    }
    // insight mode: just show the insight view, nothing else to init
}

btnDemo.addEventListener('click',    () => setMode('demo'));
btnGame.addEventListener('click',    () => setMode('game'));
btnInsight.addEventListener('click', () => setMode('insight'));

// "æ”¶æ‹¾å¿ƒæƒ… Â· å¼€å¯æ–°å±€" button inside insight view
document.getElementById('insightStartBtn').addEventListener('click', () => setMode('game'));

// Initial state
setMode('demo');
</script>
</body>
</html>
