<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COCOBO.TECH é™¤æ³•çš„ç¾å¥½ Â· å‡å¹³ä¸åˆ†äº«</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;600;700;900&family=Noto+Sans+SC:wght@300;400;500;700&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESET & ROOT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
:root {
  --sky:        #0b1829;
  --sky2:       #0d2240;
  --sky3:       #102a4c;
  --teal:       #00c2cb;
  --teal2:      #00e5f0;
  --gold:       #f5c842;
  --gold2:      #ffe082;
  --mint:       #43e9b0;
  --coral:      #ff7c6e;
  --purple:     #a78bfa;
  --white:      #e8f4fd;
  --muted:      #6b8fa8;
  --card:       rgba(255,255,255,0.04);
  --card-border:rgba(0,194,203,0.18);
  --radius:     20px;
  --radius-lg:  28px;
}
html { scroll-behavior: smooth; }
body {
  font-family: 'Noto Sans SC', sans-serif;
  background: var(--sky);
  color: var(--white);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAVBAR / LOGO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar {
  position: fixed; top:0; left:0; right:0;
  z-index: 100;
  padding: 0 12px;
  height: 52px;
  display: flex; align-items: center;
  background: rgba(7, 18, 36, 0.72);
  backdrop-filter: blur(20px) saturate(1.6);
  -webkit-backdrop-filter: blur(20px) saturate(1.6);
  border-bottom: 1px solid rgba(0,194,203,0.12);
  box-shadow: 0 4px 32px rgba(0,0,0,0.35);
}

.logo-wrap {
  display: flex; align-items: center; gap: 12px;
  text-decoration: none; user-select: none;
}

/* â”€â”€ SVG logo mark â”€â”€ */
.logo-mark {
  width: 40px; height: 40px; flex-shrink: 0;
  filter: drop-shadow(0 0 8px rgba(0,194,203,0.55));
  animation: logoSpin 18s linear infinite;
}
@keyframes logoSpin {
  0%   { filter: drop-shadow(0 0 8px rgba(0,194,203,0.55)); }
  50%  { filter: drop-shadow(0 0 14px rgba(167,139,250,0.7)); }
  100% { filter: drop-shadow(0 0 8px rgba(0,194,203,0.55)); }
}

/* â”€â”€ Wordmark â”€â”€ */
.logo-text {
  display: flex; flex-direction: column; line-height: 1;
  gap: 1px;
}
.logo-brand {
  font-family: 'Noto Sans SC', sans-serif;
  font-weight: 700;
  font-size: 18px;
  letter-spacing: 0.12em;
  background: linear-gradient(110deg, #00e5f0 0%, #a78bfa 55%, #f5c842 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
  background-size: 200% 100%;
  animation: logoShimmer 4s ease-in-out infinite;
}
@keyframes logoShimmer {
  0%,100% { background-position: 0% 50%; }
  50%      { background-position: 100% 50%; }
}
.logo-sub {
  font-family: 'Noto Sans SC', sans-serif;
  font-size: 10px; font-weight: 500;
  letter-spacing: 0.25em;
  color: rgba(0,194,203,0.55);
  text-transform: uppercase;
}

/* â”€â”€ Divider dot â”€â”€ */
.logo-divider {
  width: 1px; height: 28px;
  background: linear-gradient(180deg, transparent, rgba(0,194,203,0.3), transparent);
  margin: 0 4px;
}

/* â”€â”€ Nav right slot â”€â”€ */
.topbar-right {
  margin-left: auto;
  display: flex; align-items: center; gap: 8px;
}
.nav-tag {
  font-size: 11px; font-weight: 700;
  letter-spacing: 1.5px; text-transform: uppercase;
  color: rgba(67,233,176,0.7);
  border: 1px solid rgba(67,233,176,0.2);
  background: rgba(67,233,176,0.06);
  padding: 5px 12px; border-radius: 20px;
}

/* â”€â”€ Push page content below fixed bar â”€â”€ */
.page { padding-top: 30px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.site-footer {
  position: relative; z-index: 1;
  margin-top: 30px;
  padding: 0 18px;
  max-width: 1080px;
  margin-left: auto; margin-right: auto;
}

.footer-inner {
  border-top: 1px solid rgba(0,194,203,0.1);
  padding: 28px 0 36px;
  display: flex; align-items: center; justify-content: space-between;
  flex-wrap: wrap; gap: 16px;
}

.footer-logo-wrap {
  display: flex; align-items: center; gap: 10px;
}
.footer-logo-mark {
  width: 26px; height: 26px; opacity: 0.7;
}
.footer-brand {
  font-family: 'Noto Sans SC', sans-serif;
  font-size: 13px; font-weight: 700;
  letter-spacing: 0.15em;
  background: linear-gradient(110deg, #00c2cb, #a78bfa);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}

.footer-center {
  text-align: center; flex: 1;
}
.footer-copy {
  font-size: 12px; color: rgba(107,143,168,0.7);
  letter-spacing: 0.05em; font-weight: 400;
}
.footer-copy strong {
  color: rgba(0,194,203,0.6); font-weight: 600;
}
.footer-dept {
  display: inline-block;
  margin-top: 4px;
  font-size: 11px;
  color: rgba(245,200,66,0.5);
  letter-spacing: 0.12em;
  font-weight: 500;
}

.footer-right {
  font-size: 11px; color: rgba(214, 235, 250, 0.45);
  letter-spacing: 0.08em;
  text-align: right;
}

@media(max-width:600px){
  .footer-inner { flex-direction:column; align-items:center; text-align:center; }
  .footer-right { text-align:center; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WEBGL BACKGROUND â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#bg-canvas {
  position: fixed; inset:0;
  z-index:0; pointer-events:none;
  opacity: 0.6;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN WRAP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page {
  position: relative; z-index:1;
  max-width: 1296px;
  margin: 0 auto;
  padding: 0 20px 20px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HERO HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero {
  padding: 28px 0 16px;
  position: relative;
}

.hero-line {
  width: 60px; height: 3px;
  background: linear-gradient(90deg, var(--teal), var(--purple));
  border-radius: 2px;
  margin-bottom: 14px;
  animation: lineGrow 1.2s ease both;
}
@keyframes lineGrow { from{width:0;opacity:0} to{width:60px;opacity:1} }

.hero-title {
  font-family: 'Noto Serif SC', serif;
  font-size: clamp(20px, 3.2vw, 38px);
  font-weight: 700;
  line-height: 1.3;
  letter-spacing: 0.04em;
  color: var(--white);
  max-width: 1020px;
  text-shadow: 0 2px 40px rgba(0,194,203,0.3);
  animation: heroIn 1s 0.2s ease both;
}
@keyframes heroIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

.hero-title .highlight {
  background: linear-gradient(135deg, var(--teal2), var(--mint));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-verse {
  text-align: right;
  margin-top: 8px;
  animation: heroIn 1s 0.5s ease both;
}
.hero-verse p {
  font-family: 'Noto Serif SC', serif;
  font-size: clamp(13px, 1.8vw, 17px);
  font-weight: 400;
  color: var(--gold);
  letter-spacing: 0.08em;
  text-shadow: 0 0 20px rgba(245,200,66,0.5);
  display: inline-block;
  border-right: 3px solid var(--gold);
  padding-right: 14px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DIVIDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--teal)44, var(--purple)44, transparent);
  margin: 10px 0 14px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION CARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section-card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-lg);
  padding: 18px 22px;
  margin-bottom: 14px;
  backdrop-filter: blur(12px);
  box-shadow: 0 8px 40px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.05);
  animation: cardIn 0.7s ease both;
}
@keyframes cardIn { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
.section-card.delay1 { animation-delay: 0.1s; }
.section-card.delay2 { animation-delay: 0.2s; }
.section-card.delay3 { animation-delay: 0.3s; }

.section-label {
  display: inline-flex; align-items:center; gap:8px;
  font-size: 11px; font-weight: 700; letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--teal);
  border: 1px solid rgba(0,194,203,0.3);
  background: rgba(0,194,203,0.08);
  padding: 5px 14px; border-radius: 20px;
  margin-bottom: 10px;
}
.section-label::before { content:''; width:6px;height:6px;background:var(--teal);border-radius:50%;box-shadow:0 0 6px var(--teal); }

.section-title {
  font-family: 'Noto Serif SC', serif;
  font-size: 20px; font-weight: 600;
  color: var(--white);
  margin-bottom: 10px;
  letter-spacing: 0.03em;
  font-size: 17px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STEP 1 SIDE-BY-SIDE LAYOUT â•â•â•â•â•â• */
.step1-layout {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 20px;
  align-items: start;
}
.step1-left {
  display: flex; flex-direction: column; gap: 8px;
  min-width: 0;
}
.step1-right {
  min-width: 0;
  border-left: 1px solid rgba(0,194,203,0.12);
  padding-left: 20px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STEP 2 TOP ROW LAYOUT â•â•â•â•â•â•â•â•â•â•â• */
.step2-top-row {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 14px;
}
.step2-top-left {
  display: flex; flex-direction: column; gap: 8px;
  flex: 0 0 auto;
}
.step2-controls-inline {
  display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
}
/* formula bar in step2 becomes flex-shrink 0, auto-margin left */
#formula-bar {
  margin-left: auto;
  flex-shrink: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTROLS ROW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.controls-row {
  display: flex; align-items:center; gap:32px; flex-wrap: wrap;
}

.control-group {
  display: flex; align-items:center; gap:16px;
}

.control-label {
  font-size: 15px; font-weight: 500;
  color: var(--muted);
  white-space: nowrap;
}

/* Styled select */
.styled-select {
  position: relative;
}
.styled-select select {
  -webkit-appearance: none; appearance: none;
  background: rgba(0,194,203,0.1);
  border: 1.5px solid rgba(0,194,203,0.35);
  border-radius: 12px;
  color: var(--teal2);
  font-family: 'Noto Sans SC', sans-serif;
  font-size: 22px; font-weight: 700;
  padding: 8px 30px 8px 18px;
  cursor: pointer;
  outline: none;
  transition: all 0.25s ease;
  min-width: 70px;
  text-align: center;
}
.styled-select select:hover, .styled-select select:focus {
  background: rgba(0,194,203,0.18);
  border-color: var(--teal);
  box-shadow: 0 0 16px rgba(0,194,203,0.25);
}
.styled-select::after {
  content: 'â–¾';
  position: absolute; right:12px; top:50%; transform:translateY(-50%);
  color: var(--teal); font-size:14px; pointer-events:none;
}

.times-sign {
  font-size: 26px; font-weight: 300; color: var(--muted);
}
.equals-sign {
  font-size: 22px; font-weight: 300; color: var(--muted);
}

.total-badge {
  display: flex; align-items:center; gap:8px;
  background: linear-gradient(135deg, rgba(67,233,176,0.12), rgba(0,194,203,0.08));
  border: 1px solid rgba(67,233,176,0.3);
  border-radius: 12px;
  padding: 7px 14px;
  transition: all 0.3s ease;
}
.total-num {
  font-family: 'Noto Serif SC', serif;
  font-size: 28px; font-weight: 700;
  color: var(--mint);
  text-shadow: 0 0 20px rgba(67,233,176,0.5);
  min-width: 38px; text-align:center;
  transition: all 0.3s ease;
}
.total-label {
  font-size: 13px; color: var(--muted); font-weight: 500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ARRAY GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.array-section { }

.array-grid-container {
  min-height: 80px;
  padding: 12px;
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: var(--radius);
  position: relative;
  overflow: hidden;
}

.array-grid-container::before {
  content:'';
  position:absolute; inset:0;
  background: radial-gradient(ellipse at 50% 0%, rgba(0,194,203,0.05), transparent 60%);
  pointer-events:none;
}

.array-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 7px;
  justify-content: flex-start;
  align-items: flex-start;
}

.array-item {
  font-size: 26px;
  line-height: 1;
  cursor: default;
  transition: transform 0.3s ease;
  display: inline-flex; align-items:center; justify-content:center;
  width: 40px; height: 40px;
  border-radius: 8px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.05);
  position: relative;
  animation: itemPop 0.4s var(--delay, 0s) ease both;
  user-select: none;
}
@keyframes itemPop {
  0%  { transform:scale(0) rotate(-20deg); opacity:0; }
  70% { transform:scale(1.15) rotate(3deg); opacity:1; }
  100%{ transform:scale(1) rotate(0deg);   opacity:1; }
}
.array-item:hover { transform: scale(1.15) rotate(5deg); }

/* Item has been sent to a box â€” grey out */
.array-item.used {
  opacity: 0.22;
  filter: grayscale(1) brightness(0.55);
  transform: scale(0.82);
  border-color: rgba(255,255,255,0.04);
  background: rgba(255,255,255,0.01);
  pointer-events: none;
  transition: opacity 0.35s ease, filter 0.35s ease, transform 0.35s ease;
}

/* row separator */
.row-break { width:100%; height:0; flex-basis:100%; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DIVISION SECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kids-section { }

.kids-slider-row {
  display:flex; align-items:center; gap:16px; margin-bottom:0;
  flex-wrap:wrap;
}

.kids-count-display {
  display:flex; align-items:center; gap:12px;
}
.kids-num {
  font-family: 'Noto Serif SC', serif;
  font-size: 30px; font-weight: 700;
  color: var(--gold);
  text-shadow: 0 0 24px rgba(245,200,66,0.5);
  min-width: 42px; text-align:center;
}
.kids-label { font-size:13px; color:var(--muted); }

/* Division formula display */
.formula-bar {
  display:flex; align-items:center; gap:10px; flex-wrap:wrap;
  padding:10px 16px;
  background: linear-gradient(135deg, rgba(167,139,250,0.08), rgba(0,194,203,0.06));
  border:1px solid rgba(167,139,250,0.2);
  border-radius:14px;
  margin-bottom:0;
}
.formula-num {
  font-family:'Noto Serif SC',serif;
  font-size:22px; font-weight:700;
}
.fn-total { color:var(--mint); }
.fn-op    { color:var(--muted); font-weight:300; font-size:20px; }
.fn-div   { color:var(--gold); }
.fn-eq    { color:var(--muted); font-size:20px; font-weight:300; }
.fn-ans   { color:var(--coral); min-width:32px; }
.fn-rem   { font-size:12px; color:var(--muted); padding-left:6px; }

/* Kids row */
.kids-row {
  display: flex;
  gap: 14px;
  justify-content: flex-start;
  align-items: flex-end;
  flex-wrap: wrap;
  padding: 10px 0;
  min-height: 220px;
}

.kid-unit {
  display: flex; flex-direction:column; align-items:center;
  gap: 10px;
  animation: kidIn 0.5s ease both;
}
@keyframes kidIn {
  from{opacity:0;transform:translateY(20px) scale(0.8)}
  to{opacity:1;transform:translateY(0) scale(1)}
}

/* Kid SVG figure */
.kid-figure svg {
  width: 52px; height: 76px;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,0.4));
  transition: transform 0.3s ease;
}
.kid-unit:hover .kid-figure svg { transform: translateY(-4px); }

/* Kid box / basket */
.kid-box {
  width: 86px; height: 82px;
  border-radius: 12px;
  border: 2px dashed rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.03);
  position: relative;
  display: flex; flex-wrap:wrap;
  align-content: flex-start;
  align-items:flex-start;
  gap: 2px;
  padding: 5px;
  overflow: hidden;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}
.kid-box.active-drop {
  border-color: var(--gold);
  box-shadow: 0 0 20px rgba(245,200,66,0.25);
}
.kid-box.full {
  border-color: var(--mint);
  box-shadow: 0 0 20px rgba(67,233,176,0.2);
}

.kid-box-item {
  font-size: 15px;
  line-height: 1;
  display: inline-block;
  animation: dropIn 0.35s ease both;
}
@keyframes dropIn {
  0%  {transform:scale(0) translateY(-20px);opacity:0}
  70% {transform:scale(1.2) translateY(2px);opacity:1}
  100%{transform:scale(1) translateY(0);opacity:1}
}

.kid-name {
  font-size: 12px; color: var(--muted); font-weight: 500;
  letter-spacing: 0.5px;
}

.kid-count-badge {
  font-family:'Noto Sans SC',sans-serif;
  font-size:11px; font-weight:700;
  padding: 3px 10px;
  border-radius:20px;
  background: rgba(245,200,66,0.12);
  border: 1px solid rgba(245,200,66,0.3);
  color: var(--gold);
  min-width: 50px; text-align:center;
  transition: all 0.3s ease;
}
.kid-count-badge.complete {
  background: rgba(67,233,176,0.15);
  border-color: rgba(67,233,176,0.4);
  color: var(--mint);
}

/* Remainder zone */
.remainder-zone {
  display:flex; flex-direction:column; align-items:center; gap:8px;
  opacity:0; transition:opacity 0.4s ease;
  justify-content:flex-end;
  padding-bottom:10px;
}
.remainder-zone.visible { opacity:1; }
.remainder-label {
  font-size:12px; color:var(--coral); font-weight:600;
  letter-spacing:1px; text-transform:uppercase;
}
.remainder-box {
  width:80px; height:80px;
  border-radius:12px;
  border:2px dashed var(--coral);
  background:rgba(255,124,110,0.04);
  display:flex; flex-wrap:wrap; gap:3px; padding:6px;
  align-content:flex-start;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUTTON â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn-primary {
  position:relative; overflow:hidden;
  padding: 13px 16px;
  background: linear-gradient(135deg, #00c2cb, #00a8e0, #0090ff);
  border: none; border-radius: 50px;
  color: white;
  font-family: 'Noto Sans SC', sans-serif;
  font-size: 16px; font-weight: 700;
  cursor: pointer;
  letter-spacing: 0.05em;
  box-shadow: 0 8px 32px rgba(0,194,203,0.4), 0 2px 8px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  display:inline-flex; align-items:center; gap:10px;
}
.btn-primary::before {
  content:'';
  position:absolute; inset:0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15), transparent);
  border-radius:50px;
}
.btn-primary::after {
  content:'';
  position:absolute;
  width:100px; height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);
  left:-100%; top:0;
  transition: left 0.5s ease;
}
.btn-primary:hover { transform:translateY(-3px) scale(1.03); box-shadow:0 14px 40px rgba(0,194,203,0.55); }
.btn-primary:hover::after { left:200%; }
.btn-primary:active { transform:translateY(0) scale(0.98); }
.btn-primary:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

.btn-reset {
  padding:12px 18px;
  background:rgba(255,255,255,0.05);
  border:1.5px solid rgba(255,255,255,0.12);
  border-radius:50px;
  color:var(--muted);
  font-family:'Noto Sans SC',sans-serif;
  font-size:14px; font-weight:500;
  cursor:pointer;
  transition:all 0.25s ease;
  letter-spacing:0.05em;
}
.btn-reset:hover { background:rgba(255,255,255,0.08);color:var(--white);border-color:rgba(255,255,255,0.25); }

.btn-row {
  display:flex; align-items:center; gap:16px; flex-wrap:wrap; margin-top:14px;
  justify-content:center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESULT BANNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.result-banner {
  display:none;
  margin-top:28px;
  padding:20px 28px;
  border-radius:var(--radius);
  background:linear-gradient(135deg,rgba(67,233,176,0.1),rgba(0,194,203,0.08));
  border:1px solid rgba(67,233,176,0.3);
  text-align:center;
  animation:bannerIn 0.5s ease both;
}
@keyframes bannerIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
.result-banner.show { display:block; }
.result-text {
  font-family:'Noto Serif SC',serif;
  font-size:22px; font-weight:700;
  color:var(--mint);
  margin-bottom:8px;
  text-shadow:0 0 20px rgba(67,233,176,0.4);
}
.result-formula {
  font-size:16px; color:var(--muted); letter-spacing:0.05em;
}
.result-formula strong { color:var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FLOATING PARTICLES â•â•â•â•â•â•â•â•â•â•â•â• */
.particle {
  position:fixed; pointer-events:none; z-index:0;
  font-size:20px; opacity:0;
  animation:float var(--dur,8s) var(--delay,0s) linear infinite;
}
@keyframes float {
  0%   {transform:translateY(110vh) rotate(0deg); opacity:0}
  5%   {opacity:0.15}
  95%  {opacity:0.1}
  100% {transform:translateY(-10vh) rotate(360deg); opacity:0}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CANVAS PARTICLE OVERLAY â•â•â•â•â•â•â• */
#anim-canvas {
  position:fixed; inset:0; z-index:999;
  pointer-events:none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCROLLBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--sky)}
::-webkit-scrollbar-thumb{background:#1a3a5c;border-radius:3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:700px){
  .section-card{padding:14px 14px}
  .controls-row{gap:20px}
  .kids-row{gap:12px}
  .kid-box{width:80px;height:80px}
  .kid-figure svg{width:52px;height:76px}
  .step1-layout { grid-template-columns: 1fr; }
  .step1-right { border-left: none; border-top: 1px solid rgba(0,194,203,0.12); padding-left: 0; padding-top: 14px; }
  .step2-top-row { flex-direction: column; align-items: flex-start; }
  #formula-bar { margin-left: 0; width: 100%; }
}
</style>
</head>
<body>

<!-- WebGL / Canvas Background -->
<canvas id="bg-canvas"></canvas>
<!-- Animation overlay canvas -->
<canvas id="anim-canvas"></canvas>

<!-- Floating math particles -->
<div id="particles-wrap"></div>

<!-- â•â•â• TOP NAVIGATION BAR WITH LOGO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="topbar">
  <a class="logo-wrap" href="#">
    <!-- SVG Logo Mark -->
    <svg class="logo-mark" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg" fill="none">
      <defs>
        <linearGradient id="lg1" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%"   stop-color="#00e5f0"/>
          <stop offset="50%"  stop-color="#a78bfa"/>
          <stop offset="100%" stop-color="#f5c842"/>
        </linearGradient>
        <linearGradient id="lg2" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%"   stop-color="#00c2cb" stop-opacity="0.9"/>
          <stop offset="100%" stop-color="#a78bfa" stop-opacity="0.3"/>
        </linearGradient>
        <filter id="glow-f">
          <feGaussianBlur stdDeviation="1.2" result="blur"/>
          <feComposite in="SourceGraphic" in2="blur" operator="over"/>
        </filter>
      </defs>
      <!-- Outer orbit ring (animated rotate) -->
      <circle cx="20" cy="20" r="18" stroke="url(#lg2)" stroke-width="1.2" stroke-dasharray="4 3" opacity="0.7">
        <animateTransform attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="12s" repeatCount="indefinite"/>
      </circle>
      <!-- Inner filled circle -->
      <circle cx="20" cy="20" r="13" fill="rgba(0,194,203,0.08)" stroke="url(#lg1)" stroke-width="1.5"/>
      <!-- Division symbol -->
      <circle cx="20" cy="13.5" r="2.2" fill="url(#lg1)" filter="url(#glow-f)"/>
      <circle cx="20" cy="26.5" r="2.2" fill="url(#lg1)" filter="url(#glow-f)"/>
      <rect x="12" y="18.8" width="16" height="2.4" rx="1.2" fill="url(#lg1)" filter="url(#glow-f)"/>
      <!-- Sparkle dots -->
      <circle cx="32" cy="12" r="1.3" fill="#f5c842" opacity="0.8">
        <animate attributeName="opacity" values="0.8;0.2;0.8" dur="2.5s" repeatCount="indefinite"/>
      </circle>
      <circle cx="8"  cy="28" r="1"   fill="#43e9b0" opacity="0.6">
        <animate attributeName="opacity" values="0.6;0.1;0.6" dur="3.2s" repeatCount="indefinite"/>
      </circle>
      <circle cx="30" cy="30" r="1"   fill="#a78bfa" opacity="0.7">
        <animate attributeName="opacity" values="0.7;0.2;0.7" dur="2s" repeatCount="indefinite"/>
      </circle>
    </svg>

    <div class="logo-divider"></div>

    <div class="logo-text">
      <span class="logo-brand">COCOBO é™¤æ³•</span>
      <span class="logo-sub">Math &nbsp;Â·&nbsp; Division</span>
    </div>
  </a>
  <div class="topbar-right">
    <span class="nav-tag">äº’åŠ¨å­¦ä¹ </span>
  </div>
</nav>

<div class="page">

  <!-- â•â•â• HERO HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <header class="hero">
    <div class="hero-line"></div>
    <h1 class="hero-title">
      é™¤æ³•ä¸ä»…æ˜¯æ•°å­¦ï¼Œå®ƒè®©æˆ‘ä»¬çœ‹è§<span class="highlight">å…¬å¹³ã€å‡å¹³ä¸åˆ†äº«</span>
    </h1>
    <div class="hero-verse">
      <p>è¿™å°±å‡å¹³äº† &nbsp;â€”â€”&nbsp; å“¥æ—å¤šåä¹¦ 8:14</p>
    </div>
  </header>

  <div class="divider"></div>

  <!-- â•â•â• STEP 1: ARRAY CONFIG + PREVIEW (side by side) â•â• -->
  <div class="section-card delay1">
    <div class="step1-layout">
      <!-- Left: controls -->
      <div class="step1-left">
        <div class="section-label">ç¬¬ä¸€æ­¥ Â· è®¾ç½®é˜µåˆ—</div>
        <h2 class="section-title">é€‰æ‹©è¡Œæ•°ä¸åˆ—æ•°</h2>
        <div class="control-group">
          <span class="control-label">è¡Œ</span>
          <div class="styled-select">
            <select id="sel-rows">
              <option value="1">1</option><option value="2">2</option>
              <option value="3" selected>3</option><option value="4">4</option>
              <option value="5">5</option><option value="6">6</option>
              <option value="7">7</option><option value="8">8</option>
              <option value="9">9</option>
            </select>
          </div>
          <span class="times-sign">Ã—</span>
          <span class="control-label">åˆ—</span>
          <div class="styled-select">
            <select id="sel-cols">
              <option value="1">1</option><option value="2">2</option>
              <option value="3">3</option><option value="4" selected>4</option>
              <option value="5">5</option><option value="6">6</option>
              <option value="7">7</option><option value="8">8</option>
              <option value="9">9</option>
            </select>
          </div>
          <span class="equals-sign">=</span>
          <div class="total-badge">
            <span class="total-num" id="total-display">12</span>
            <span class="total-label">ä¸ªç‰©å“</span>
          </div>
        </div>
      </div>
      <!-- Right: array preview -->
      <div class="step1-right" id="array-card">
        <div class="section-label" style="font-size:10px;padding:3px 10px;margin-bottom:8px">ç‰©å“é˜µåˆ—é¢„è§ˆ</div>
        <div class="array-grid-container">
          <div class="array-grid" id="array-grid"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• STEP 2: DIVISION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="section-card delay2" id="kids-card">

    <!-- Top row: label+title+selector LEFT, formula RIGHT -->
    <div class="step2-top-row">
      <div class="step2-top-left">
        <div class="section-label">ç¬¬äºŒæ­¥ Â· åˆ†äº«ç»™å°æœ‹å‹</div>
        <div class="step2-controls-inline">
          <span class="control-label">é€‰æ‹©åˆ†ç»™å‡ ä¸ªå°æœ‹å‹</span>
          <div class="styled-select">
            <select id="sel-kids">
              <option value="1">1</option><option value="2" selected>2</option>
              <option value="3">3</option><option value="4">4</option>
              <option value="5">5</option><option value="6">6</option>
              <option value="7">7</option><option value="8">8</option>
              <option value="9">9</option>
            </select>
          </div>
          <div class="kids-count-display">
            <span class="kids-num" id="kids-num-display">2</span>
            <span class="kids-label">ä½å°æœ‹å‹</span>
          </div>
        </div>
      </div>
      <!-- Division formula RIGHT -->
      <div class="formula-bar" id="formula-bar">
        <span class="formula-num fn-total" id="f-total">12</span>
        <span class="formula-num fn-op">Ã·</span>
        <span class="formula-num fn-div" id="f-div">2</span>
        <span class="formula-num fn-eq">=</span>
        <span class="formula-num fn-ans" id="f-ans">6</span>
        <span class="fn-rem" id="f-rem"></span>
      </div>
    </div>

    <!-- Kids display area -->
    <div class="kids-row" id="kids-row"></div>

    <!-- Action buttons -->
    <div class="btn-row">
      <button class="btn-primary" id="btn-animate" onclick="startAnimation()">
        <span>â–¶</span> å¼€å§‹åŠ¨ç”»æ¼”ç¤º
      </button>
      <button class="btn-reset" id="btn-reset" onclick="resetAll()">
        â†º é‡ç½®
      </button>
    </div>

    <!-- Result banner -->
    <div class="result-banner" id="result-banner">
      <div class="result-text" id="result-text">ğŸ‰ åˆ†é…å®Œæˆï¼</div>
      <div class="result-formula" id="result-formula"></div>
    </div>
  </div>

</div><!-- /page -->

<!-- â•â•â• SITE FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-logo-wrap">
      <svg class="footer-logo-mark" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" fill="none">
        <defs>
          <linearGradient id="flg" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#00c2cb"/>
            <stop offset="100%" stop-color="#a78bfa"/>
          </linearGradient>
        </defs>
        <circle cx="13" cy="13" r="12" stroke="url(#flg)" stroke-width="1" opacity="0.6"/>
        <circle cx="13" cy="8.5"  r="1.6" fill="url(#flg)"/>
        <circle cx="13" cy="17.5" r="1.6" fill="url(#flg)"/>
        <rect x="7.5" y="12" width="11" height="2" rx="1" fill="url(#flg)"/>
      </svg>
      <span class="footer-brand">COCOBO</span>
    </div>
    <div class="footer-center">
      <div class="footer-copy">&copy; 2026 &nbsp;<strong>cocobo.tech</strong></div>
      <div class="footer-dept">æ•° å­¦ éƒ¨</div>
    </div>
    <div class="footer-right">è®©æ¯ä¸ªå­©å­<br>çˆ±ä¸Šæ•°å­¦</div>
  </div>
</footer>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIGURATION & STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EMOJIS = {
  apple:       'ğŸ',
  grape:       'ğŸ‡',
  watermelon:  'ğŸ‰',
  orange:      'ğŸŠ',
  dog:         'ğŸ¶',
  strawberry:  'ğŸ“'
};
const EMOJI_LIST = Object.values(EMOJIS);
const KID_COLORS = ['#00c2cb','#a78bfa','#f5c842','#ff7c6e','#43e9b0','#60a5fa','#fb923c','#e879f9','#34d399'];
const KID_NAMES  = ['å°æ˜','å°çº¢','å°å','å°æœˆ','å°æ˜Ÿ','å°äº‘','å°æ³¢','å°èŠ³','å°é¾™'];

let state = {
  rows: 3, cols: 4,
  kids: 2,
  chosenEmoji: EMOJI_LIST[0],
  isAnimating: false,
  animDone: false
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEBGL BACKGROUND
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function initWebGL() {
  const canvas = document.getElementById('bg-canvas');
  const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
  if (!gl) { canvas.style.display='none'; return; }

  function resize() {
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;
    gl.viewport(0, 0, canvas.width, canvas.height);
  }
  resize(); window.addEventListener('resize', resize);

  const vert = `
    attribute vec2 position;
    void main(){gl_Position=vec4(position,0.,1.);}
  `;
  const frag = `
    precision mediump float;
    uniform float time;
    uniform vec2  res;

    float hash(vec2 p){return fract(sin(dot(p,vec2(127.1,311.7)))*43758.5453);}

    float noise(vec2 p){
      vec2 i=floor(p), f=fract(p), u=f*f*(3.-2.*f);
      return mix(mix(hash(i),hash(i+vec2(1,0)),u.x),mix(hash(i+vec2(0,1)),hash(i+vec2(1,1)),u.x),u.y);
    }

    void main(){
      vec2 uv=gl_FragCoord.xy/res;
      uv.x*=res.x/res.y;

      float n=noise(uv*3.+time*0.12)*0.5
             +noise(uv*7.-time*0.08)*0.25
             +noise(uv*15.+time*0.05)*0.125;

      vec3 col1=vec3(0.04,0.09,0.18);
      vec3 col2=vec3(0.00,0.45,0.55);
      vec3 col3=vec3(0.06,0.15,0.32);

      vec3 c=mix(col1,col3,uv.y*0.8);
      c=mix(c,col2,n*0.18*smoothstep(0.3,0.7,uv.y));

      // Stars
      float s=hash(floor(uv*200.)+(floor(time*0.05)));
      float star=step(0.995,s)*0.5;
      c+=vec3(star*(0.5+0.5*sin(time*2.+uv.x*30.)));

      gl_FragColor=vec4(c,1.);
    }
  `;

  function mkShader(type, src) {
    const s = gl.createShader(type);
    gl.shaderSource(s, src); gl.compileShader(s);
    return s;
  }
  const prog = gl.createProgram();
  gl.attachShader(prog, mkShader(gl.VERTEX_SHADER, vert));
  gl.attachShader(prog, mkShader(gl.FRAGMENT_SHADER, frag));
  gl.linkProgram(prog); gl.useProgram(prog);

  const buf = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, buf);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, 1,1]), gl.STATIC_DRAW);
  const pos = gl.getAttribLocation(prog, 'position');
  gl.enableVertexAttribArray(pos);
  gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);

  const uTime = gl.getUniformLocation(prog, 'time');
  const uRes  = gl.getUniformLocation(prog, 'res');

  const start = Date.now();
  function render() {
    const t = (Date.now() - start) / 1000;
    gl.uniform1f(uTime, t);
    gl.uniform2f(uRes, canvas.width, canvas.height);
    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
    requestAnimationFrame(render);
  }
  render();
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLOATING PARTICLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function initParticles() {
  const wrap = document.getElementById('particles-wrap');
  const symbols = ['Ã·','Ã—','+','âˆ’','=','Â½','â…“','â…”','Â¼','Â¾'];
  for (let i = 0; i < 18; i++) {
    const d = document.createElement('div');
    d.className = 'particle';
    d.textContent = symbols[Math.floor(Math.random() * symbols.length)];
    d.style.cssText = `
      left:${Math.random()*100}vw;
      font-size:${14+Math.random()*18}px;
      --dur:${10+Math.random()*14}s;
      --delay:${Math.random()*12}s;
      color:${['#00c2cb33','#a78bfa33','#f5c84233','#43e9b033'][Math.floor(Math.random()*4)]};
      position:fixed; pointer-events:none; z-index:0;
      opacity:0; animation:float var(--dur) var(--delay) linear infinite;
    `;
    wrap.appendChild(d);
  }
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATION CANVAS (for flying items)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const animCanvas = document.getElementById('anim-canvas');
const actx = animCanvas.getContext('2d');
function resizeAnimCanvas() {
  animCanvas.width  = window.innerWidth;
  animCanvas.height = window.innerHeight;
}
resizeAnimCanvas();
window.addEventListener('resize', resizeAnimCanvas);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pickRandomEmoji() {
  return EMOJI_LIST[Math.floor(Math.random() * EMOJI_LIST.length)];
}

function getTotal() { return state.rows * state.cols; }

function calcDivision() {
  const total = getTotal();
  const kids  = state.kids;
  return {
    each:      Math.floor(total / kids),
    remainder: total % kids
  };
}

function easeInOutCubic(t) {
  return t < 0.5 ? 4*t*t*t : 1-Math.pow(-2*t+2,3)/2;
}

function lerp(a, b, t) { return a + (b - a) * t; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD ARRAY GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildArrayGrid() {
  const grid = document.getElementById('array-grid');
  grid.innerHTML = '';
  const total = getTotal();
  state.chosenEmoji = pickRandomEmoji();

  for (let r = 0; r < state.rows; r++) {
    for (let c = 0; c < state.cols; c++) {
      const item = document.createElement('div');
      item.className = 'array-item';
      item.id = `item-${r * state.cols + c}`;
      item.textContent = state.chosenEmoji;
      item.style.setProperty('--delay', `${(r * state.cols + c) * 0.04}s`);
      grid.appendChild(item);
    }
    if (r < state.rows - 1) {
      const br = document.createElement('div');
      br.className = 'row-break';
      grid.appendChild(br);
    }
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD KIDS ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildKidsRow() {
  const row = document.getElementById('kids-row');
  row.innerHTML = '';
  const { each, remainder } = calcDivision();

  for (let k = 0; k < state.kids; k++) {
    const color = KID_COLORS[k % KID_COLORS.length];
    const name  = KID_NAMES[k];

    const unit = document.createElement('div');
    unit.className = 'kid-unit';
    unit.style.animationDelay = `${k * 0.08}s`;
    unit.id = `kid-unit-${k}`;

    // SVG kid figure
    unit.innerHTML = `
      <div class="kid-figure">${makeSVGKid(color, k)}</div>
      <div class="kid-box" id="kid-box-${k}" data-kid="${k}"></div>
      <div class="kid-count-badge" id="kid-badge-${k}">0 / ${each}</div>
      <div class="kid-name">${name}</div>
    `;
    row.appendChild(unit);
  }

  // Remainder zone
  if (remainder > 0) {
    const remZone = document.createElement('div');
    remZone.className = 'remainder-zone';
    remZone.id = 'remainder-zone';
    remZone.innerHTML = `
      <div class="remainder-label">ä½™ ${remainder}</div>
      <div class="remainder-box" id="rem-box"></div>
    `;
    row.appendChild(remZone);
  }

  updateFormula();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SVG KID FIGURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function makeSVGKid(color, idx) {
  const hairColors = ['#3d2800','#1a1a1a','#8B4513','#FFD700','#2c2c54','#4a0080'];
  const hair = hairColors[idx % hairColors.length];
  const shirtColors = [color, '#ff7c6e','#43e9b0','#a78bfa','#f5c842','#60a5fa'];
  const shirt = shirtColors[idx % shirtColors.length];

  return `<svg viewBox="0 0 64 90" xmlns="http://www.w3.org/2000/svg">
    <!-- shadow -->
    <ellipse cx="32" cy="88" rx="18" ry="4" fill="rgba(0,0,0,0.2)"/>
    <!-- legs -->
    <rect x="20" y="64" width="10" height="22" rx="5" fill="${shirt}" opacity="0.8"/>
    <rect x="34" y="64" width="10" height="22" rx="5" fill="${shirt}" opacity="0.8"/>
    <!-- shoes -->
    <ellipse cx="25" cy="86" rx="8" ry="4" fill="#2c2c54"/>
    <ellipse cx="39" cy="86" rx="8" ry="4" fill="#2c2c54"/>
    <!-- body -->
    <rect x="16" y="36" width="32" height="30" rx="10" fill="${shirt}"/>
    <!-- collar accent -->
    <path d="M28 36 Q32 42 36 36" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="1.5"/>
    <!-- arms -->
    <rect x="4"  y="38" width="14" height="8" rx="4" fill="${shirt}" transform="rotate(-10,11,42)"/>
    <rect x="46" y="38" width="14" height="8" rx="4" fill="${shirt}" transform="rotate(10,53,42)"/>
    <!-- hands -->
    <circle cx="8"  cy="47" r="5" fill="#fcd5b0"/>
    <circle cx="56" cy="47" r="5" fill="#fcd5b0"/>
    <!-- neck -->
    <rect x="27" y="26" width="10" height="12" rx="5" fill="#fcd5b0"/>
    <!-- head -->
    <ellipse cx="32" cy="20" rx="16" ry="18" fill="#fcd5b0"/>
    <!-- hair top -->
    <ellipse cx="32" cy="7" rx="16" ry="10" fill="${hair}"/>
    <!-- hair side -->
    <rect x="16" y="6" width="6" height="14" rx="3" fill="${hair}"/>
    <rect x="42" y="6" width="6" height="14" rx="3" fill="${hair}"/>
    <!-- eyes -->
    <ellipse cx="25" cy="20" rx="3" ry="3.5" fill="white"/>
    <ellipse cx="39" cy="20" rx="3" ry="3.5" fill="white"/>
    <circle  cx="26" cy="21" r="2" fill="#2c2c54"/>
    <circle  cx="40" cy="21" r="2" fill="#2c2c54"/>
    <circle  cx="27" cy="20" r="0.7" fill="white"/>
    <circle  cx="41" cy="20" r="0.7" fill="white"/>
    <!-- eyebrows -->
    <path d="M22 16 Q25 14 28 16" stroke="${hair}" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M36 16 Q39 14 42 16" stroke="${hair}" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <!-- cheeks -->
    <ellipse cx="19" cy="24" rx="4" ry="3" fill="${color}" opacity="0.3"/>
    <ellipse cx="45" cy="24" rx="4" ry="3" fill="${color}" opacity="0.3"/>
    <!-- smile -->
    <path d="M27 28 Q32 33 37 28" stroke="#c47a5a" stroke-width="1.5" fill="none" stroke-linecap="round"/>
  </svg>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPDATE FORMULA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateFormula() {
  const total = getTotal();
  const kids  = state.kids;
  const { each, remainder } = calcDivision();

  document.getElementById('f-total').textContent = total;
  document.getElementById('f-div').textContent   = kids;
  document.getElementById('f-ans').textContent   = each;
  document.getElementById('f-rem').textContent   =
    remainder > 0 ? `â€¦ä½™ ${remainder}` : 'æ•´é™¤ âœ“';
  document.getElementById('f-rem').style.color =
    remainder > 0 ? 'var(--coral)' : 'var(--mint)';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN ANIMATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function startAnimation() {
  if (state.isAnimating) return;
  state.isAnimating = true;
  state.animDone    = false;

  const btn = document.getElementById('btn-animate');
  btn.disabled = true;
  document.getElementById('result-banner').classList.remove('show');

  // Reset boxes
  for (let k = 0; k < state.kids; k++) {
    const box = document.getElementById(`kid-box-${k}`);
    if (box) { box.innerHTML = ''; box.classList.remove('active-drop','full'); }
    const badge = document.getElementById(`kid-badge-${k}`);
    if (badge) { badge.textContent = `0 / ${calcDivision().each}`; badge.classList.remove('complete'); }
  }
  const remBox = document.getElementById('rem-box');
  if (remBox) remBox.innerHTML = '';

  const { each, remainder } = calcDivision();
  const total = getTotal();
  const items = [];

  // Collect source item positions
  for (let i = 0; i < total; i++) {
    const el = document.getElementById(`item-${i}`);
    if (el) {
      const rect = el.getBoundingClientRect();
      items.push({ el, rect, index: i });
    }
  }

  // Distribute: round-robin (kid 0 gets items 0,kids,2*kids... etc)
  const assignments = []; // {itemIdx, kidIdx}
  let kidCounts = Array(state.kids).fill(0);

  for (let i = 0; i < total; i++) {
    const kidIdx = Math.floor(i / each) < state.kids
      ? (each > 0 ? Math.floor(i % (each * state.kids) / each) % state.kids : 0)
      : -1; // remainder

    // Simpler: fill each kid in order
    const assignedKid = Math.floor(i / each);
    if (assignedKid < state.kids) {
      assignments.push({ itemIdx: i, kidIdx: assignedKid });
    } else {
      assignments.push({ itemIdx: i, kidIdx: -1 }); // remainder
    }
  }

  // Actually we want round-robin for visual fairness
  const roundRobin = [];
  const tempCounts = Array(state.kids).fill(0);
  for (let i = 0; i < total; i++) {
    // find next kid that still needs items
    let assigned = false;
    for (let attempt = 0; attempt < state.kids; attempt++) {
      const kid = i % state.kids;
      const targetKid = (Math.floor(i / 1) % state.kids);
      const rr = i % state.kids;
      if (tempCounts[rr] < each) {
        tempCounts[rr]++;
        roundRobin.push({ itemIdx: i, kidIdx: rr });
        assigned = true; break;
      }
    }
    if (!assigned) {
      // remainder
      roundRobin.push({ itemIdx: i, kidIdx: -1 });
    }
  }

  // Animate one item at a time with slight overlap
  for (let i = 0; i < roundRobin.length; i++) {
    const { itemIdx, kidIdx } = roundRobin[i];
    await animateItem(items[itemIdx], kidIdx, kidCounts, each, i);
    if (kidIdx >= 0) kidCounts[kidIdx]++;
    await sleep(60); // slight pause between items
  }

  // Show remainder zone
  const remZone = document.getElementById('remainder-zone');
  if (remZone && remainder > 0) {
    remZone.classList.add('visible');
  }

  // Show celebration
  await sleep(300);
  showResult();
  launchCelebration();

  state.isAnimating = false;
  state.animDone    = true;
  btn.disabled = false;
}

/* â”€â”€â”€ Animate single item flying from grid to kid box â”€â”€â”€ */
function animateItem(srcItem, kidIdx, kidCounts, each, order) {
  return new Promise(resolve => {
    const startRect = srcItem.el.getBoundingClientRect();
    const emoji = state.chosenEmoji;

    // Get destination
    let destRect;
    if (kidIdx >= 0) {
      const box = document.getElementById(`kid-box-${kidIdx}`);
      if (!box) { resolve(); return; }
      destRect = box.getBoundingClientRect();
      box.classList.add('active-drop');
    } else {
      const remBox = document.getElementById('rem-box');
      const remZone = document.getElementById('remainder-zone');
      if (remZone) remZone.classList.add('visible');
      destRect = remBox ? remBox.getBoundingClientRect() : startRect;
    }

    // Mark source item as "in flight" (subtle pre-dim)
    srcItem.el.style.opacity = '0.15';
    srcItem.el.style.transform = 'scale(0.7)';

    const startX = startRect.left + startRect.width / 2;
    const startY = startRect.top  + startRect.height / 2;
    const endX   = destRect.left  + destRect.width  / 2;
    const endY   = destRect.top   + destRect.height / 2;

    // Arc control point (rise above)
    const midX = (startX + endX) / 2;
    const midY = Math.min(startY, endY) - 80 - Math.random() * 60;

    const duration = 500 + Math.random() * 150;
    const startTime = performance.now();

    // Draw on canvas
    function step(now) {
      const t = Math.min((now - startTime) / duration, 1);
      const et = easeInOutCubic(t);

      // Quadratic bezier
      const x = (1-et)*(1-et)*startX + 2*(1-et)*et*midX + et*et*endX;
      const y = (1-et)*(1-et)*startY + 2*(1-et)*et*midY + et*et*endY;
      const scale = 0.8 + 0.4 * Math.sin(et * Math.PI);
      const rotation = et * 360 * (kidIdx % 2 === 0 ? 1 : -1);

      // Clear previous frame drawing for this item (we keep other items)
      // Instead, we use a full clear + redraw approach via a single RAF
      // Paint onto canvas
      actx.save();
      actx.translate(x, y);
      actx.rotate(rotation * Math.PI / 180);
      actx.scale(scale, scale);
      actx.font = '28px serif';
      actx.textAlign = 'center';
      actx.textBaseline = 'middle';
      actx.globalAlpha = t < 0.9 ? 1 : 1 - (t-0.9)/0.1;
      actx.fillText(emoji, 0, 0);
      actx.restore();

      if (t < 1) {
        requestAnimationFrame(step);
      } else {
        // Drop into box
        dropItemIntoBox(kidIdx, emoji, each);
        resolve();
      }
    }

    // We need to clear canvas each frame but multiple items can animate
    // Use a shared loop approach
    scheduleAnimFrame(srcItem.el, startX, startY, endX, endY, midX, midY,
                      duration, emoji, kidIdx, each, resolve, srcItem.index);
  });
}

/* â”€â”€â”€ Shared canvas animation scheduler â”€â”€â”€ */
const activeAnims = [];
let rafRunning = false;

function scheduleAnimFrame(srcEl, sx, sy, ex, ey, mx, my, dur, emoji, kidIdx, each, resolve, itemIdx) {
  activeAnims.push({ srcEl, sx, sy, ex, ey, mx, my, dur, emoji, kidIdx, each, resolve, itemIdx, start: performance.now(), done: false });
  if (!rafRunning) runAnimLoop();
}

function runAnimLoop() {
  rafRunning = true;

  function loop(now) {
    actx.clearRect(0, 0, animCanvas.width, animCanvas.height);
    let anyActive = false;

    for (const a of activeAnims) {
      if (a.done) continue;
      const t = Math.min((now - a.start) / a.dur, 1);
      const et = easeInOutCubic(t);

      const x = (1-et)*(1-et)*a.sx + 2*(1-et)*et*a.mx + et*et*a.ex;
      const y = (1-et)*(1-et)*a.sy + 2*(1-et)*et*a.my + et*et*a.ey;
      const scale  = 0.8 + 0.5 * Math.sin(et * Math.PI);
      const rotate = et * 300 * (a.kidIdx % 2 === 0 ? 1 : -1);
      const alpha  = t < 0.85 ? 1 : 1 - (t - 0.85) / 0.15;

      actx.save();
      actx.globalAlpha = alpha;
      actx.translate(x, y);
      actx.rotate(rotate * Math.PI / 180);
      actx.scale(scale, scale);
      actx.font = '30px serif';
      actx.textAlign = 'center';
      actx.textBaseline = 'middle';
      actx.fillText(a.emoji, 0, 0);

      // Glow trail
      if (t < 0.7) {
        actx.globalAlpha = alpha * 0.3;
        actx.font = '24px serif';
        actx.fillText(a.emoji, -3 * et, 3 * et);
      }
      actx.restore();

      if (t >= 1) {
        a.done = true;
        // Grey out the source array item â€” apply .used class
        if (a.srcEl) {
          a.srcEl.style.opacity = '';
          a.srcEl.style.transform = '';
          a.srcEl.classList.add('used');
        }
        dropItemIntoBox(a.kidIdx, a.emoji, a.each);
        a.resolve();
      } else {
        anyActive = true;
      }
    }

    // Remove done
    for (let i = activeAnims.length - 1; i >= 0; i--) {
      if (activeAnims[i].done) activeAnims.splice(i, 1);
    }

    if (anyActive || activeAnims.length > 0) {
      requestAnimationFrame(loop);
    } else {
      rafRunning = false;
      actx.clearRect(0, 0, animCanvas.width, animCanvas.height);
    }
  }
  requestAnimationFrame(loop);
}

/* â”€â”€â”€ Drop item visually into kid box â”€â”€â”€ */
function dropItemIntoBox(kidIdx, emoji, each) {
  if (kidIdx < 0) {
    const remBox = document.getElementById('rem-box');
    if (remBox) {
      const span = document.createElement('span');
      span.className = 'kid-box-item';
      span.textContent = emoji;
      remBox.appendChild(span);
    }
    return;
  }

  const box = document.getElementById(`kid-box-${kidIdx}`);
  const badge = document.getElementById(`kid-badge-${kidIdx}`);
  if (!box) return;

  const span = document.createElement('span');
  span.className = 'kid-box-item';
  span.textContent = emoji;
  box.appendChild(span);

  const current = box.querySelectorAll('.kid-box-item').length;
  if (badge) {
    badge.textContent = `${current} / ${each}`;
    if (current >= each) {
      badge.classList.add('complete');
      box.classList.remove('active-drop');
      box.classList.add('full');
      // Brief pop animation on kid
      const kidUnit = document.getElementById(`kid-unit-${kidIdx}`);
      if (kidUnit) {
        kidUnit.style.animation = 'none';
        void kidUnit.offsetWidth;
        kidUnit.style.animation = 'kidPop 0.4s ease both';
      }
    }
  }
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOW RESULT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showResult() {
  const total = getTotal();
  const kids  = state.kids;
  const { each, remainder } = calcDivision();
  const banner = document.getElementById('result-banner');
  const text   = document.getElementById('result-text');
  const formula = document.getElementById('result-formula');

  text.textContent = remainder === 0
    ? 'ğŸ‰ å‡å¹³åˆ†é…å®Œæˆï¼å…¬å¹³ã€å‡å¹³ä¸åˆ†äº«ï¼'
    : `ğŸ‰ åˆ†é…å®Œæˆï¼ï¼ˆæœ‰ ${remainder} ä¸ªä½™ä¸‹ï¼‰`;

  let fText = `<strong>${total}</strong> ${state.chosenEmoji} Ã· <strong>${kids}</strong> ä½å°æœ‹å‹ = æ¯äºº <strong>${each}</strong> ä¸ª`;
  if (remainder > 0) fText += `ï¼Œä½™ <strong>${remainder}</strong> ä¸ª`;
  formula.innerHTML = fText;

  banner.classList.add('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CELEBRATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function launchCelebration() {
  const celebEmojis = ['ğŸ‰','â­','ğŸŒŸ','âœ¨','ğŸŠ','ğŸ’«','ğŸˆ','ğŸ€'];
  const particles2 = [];
  const canvas2 = animCanvas;
  const ctx2 = actx;

  for (let i = 0; i < 35; i++) {
    particles2.push({
      x: Math.random() * canvas2.width,
      y: canvas2.height + 20,
      vx: (Math.random() - 0.5) * 4,
      vy: -(6 + Math.random() * 8),
      gravity: 0.2,
      emoji: celebEmojis[Math.floor(Math.random() * celebEmojis.length)],
      size: 20 + Math.random() * 20,
      alpha: 1,
      rotation: Math.random() * 360,
      rotSpeed: (Math.random() - 0.5) * 8,
      delay: Math.random() * 0.5
    });
  }

  const startT = performance.now();
  function celebLoop(now) {
    ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
    let any = false;
    for (const p of particles2) {
      const age = (now - startT) / 1000;
      if (age < p.delay) { any = true; continue; }
      p.x  += p.vx;
      p.y  += p.vy;
      p.vy += p.gravity;
      p.rotation += p.rotSpeed;
      p.alpha -= 0.012;

      if (p.alpha <= 0) continue;
      any = true;

      ctx2.save();
      ctx2.globalAlpha = p.alpha;
      ctx2.translate(p.x, p.y);
      ctx2.rotate(p.rotation * Math.PI / 180);
      ctx2.font = `${p.size}px serif`;
      ctx2.textAlign = 'center';
      ctx2.textBaseline = 'middle';
      ctx2.fillText(p.emoji, 0, 0);
      ctx2.restore();
    }
    if (any) requestAnimationFrame(celebLoop);
    else ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
  }
  requestAnimationFrame(celebLoop);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function resetAll() {
  state.isAnimating = false;
  state.animDone = false;
  document.getElementById('result-banner').classList.remove('show');
  actx.clearRect(0, 0, animCanvas.width, animCanvas.height);
  // Clear any active animations
  activeAnims.length = 0;
  buildArrayGrid();  // rebuilds fresh items without .used
  buildKidsRow();
  const btn = document.getElementById('btn-animate');
  btn.disabled = false;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVENT LISTENERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('sel-rows').addEventListener('change', function() {
  state.rows = parseInt(this.value);
  updateTotal();
  resetAll();
});
document.getElementById('sel-cols').addEventListener('change', function() {
  state.cols = parseInt(this.value);
  updateTotal();
  resetAll();
});
document.getElementById('sel-kids').addEventListener('change', function() {
  state.kids = parseInt(this.value);
  document.getElementById('kids-num-display').textContent = state.kids;
  buildKidsRow();
  document.getElementById('result-banner').classList.remove('show');
});

function updateTotal() {
  const total = getTotal();
  const el = document.getElementById('total-display');
  el.textContent = total;
  // Pop animation
  el.style.animation = 'none';
  void el.offsetWidth;
  el.style.animation = 'totalPop 0.4s ease both';
}

// Add kid pop keyframe dynamically
const styleEl = document.createElement('style');
styleEl.textContent = `
  @keyframes kidPop {
    0%  {transform:scale(1)}
    40% {transform:scale(1.15) translateY(-8px)}
    70% {transform:scale(0.95)}
    100%{transform:scale(1)}
  }
  @keyframes totalPop {
    0%  {transform:scale(1)}
    50% {transform:scale(1.3)}
    100%{transform:scale(1)}
  }
`;
document.head.appendChild(styleEl);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INITIALISE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
buildArrayGrid();
buildKidsRow();
</script>
</body>
</html>
