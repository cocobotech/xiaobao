<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯å¯æ³¢ä¹˜æ³•æ¢ç´¢ä¹å›­</title>
    
    <style>
        /* CSS Variables for colors and dimensions */
        :root {
            --color-pink: #ec4899; /* pink-500 */
            --color-green: #10b981; /* green-500 */
            --color-blue: #3b82f6; /* blue-500 */
            --color-purple: #9333ea; /* purple-700 */
            --color-red: #dc2626; /* red-600 */
            --bg-light-purple: #f5f3ff; /* purple-50 */
            --bg-light-teal: #f0fdfa; /* teal-50 */
            --bg-light-yellow: #fffbeb; /* yellow-50 */
            --max-width: 56rem; /* max-w-4xl */
        }

        /* Base and Layout (equivalent to p-4 flex justify-center items-start min-h-screen) */
        body {
            background-color: #f0f9ff;
            font-family: 'Inter', sans-serif;
            padding: 1rem; 
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        #app {
            width: 100%;
            max-width: var(--max-width);
        }
        
        /* Header */
        header {
            text-align: center;
            margin-bottom: 2rem; /* mb-8 */
            padding: 1rem; /* p-4 */
            background-color: #fef3c7; /* yellow-100 */
            border-radius: 1rem; /* rounded-2xl */
            border: 4px solid #f59e0b; /* border-yellow-500 */
        }
        h1 {
            font-size: 2.25rem; /* text-4xl */
        }
        header p {
            color: #4b5563; /* gray-700 */
            margin-top: 0.5rem; /* mt-2 */
            font-size: 1.25rem; /* text-xl */
        }

        /* Main Grid (grid grid-cols-1 gap-6) */
        main {
            display: grid;
            grid-template-columns: 2fr;
            gap: 1.5rem; 
        }

        /* Media Query for responsiveness (md and lg breakpoints) */
        @media (min-width: 768px) {
            body {
                padding: 2rem; /* md:p-8 */
            }
            .column-container {
                row-gap: 0.5rem; /* md:gap-2 */
            }
            .column-container span {
                font-size: 2.25rem; /* md:text-4xl */
            }
            h1 {
                font-size: 3rem; /* md:text-5xl */
            }
            .result-value {
                font-size: 3.75rem; /* md:text-6xl */
            
        }
        @media (min-width: 1024px) {
            main {
                grid-template-columns: 1fr 2fr; /* lg:grid-cols-3 */
            }
            .lg-col-span-1 {
                grid-column: span 1 / span 1;
            }
            .lg-col-span-2 {
                grid-column: span 1 / span 1;
            }
        }

        /* Card and Shadow Styles */
        .card {
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            background-color: white;
            border: 3px solid var(--color-blue);
            padding: 1.5rem; /* p-6 */
            border-radius: 1rem; /* rounded-2xl */
        }
        .control-panel {
            border-color: var(--color-purple);
            background-color: var(--bg-light-purple);
            height: 100%; /* h-full */
        }
        .vis-panel {
            border-color: #0d9488; /* teal-500 */
            background-color: var(--bg-light-teal);
        }

        /* Typography */
        h2 {
            font-size: 1.875rem; /* text-3xl */
            font-weight: bold;
            color: var(--color-purple);
            margin-bottom: 1.5rem; /* mb-6 */
            text-align: left;
        }
        .rainbow-text {
            background-image: linear-gradient(to right, #ef4444, #f97316, #facc15, #10b981, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        .explanation-text {
            color: #d97706;
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Controls and Inputs */
        .control-group {
            margin-bottom: 2rem; /* mb-8 */
            padding: 1rem; /* p-4 */
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* shadow-lg */
        }
        .control-label {
            display: block;
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600;
            margin-bottom: 0.75rem; /* mb-3 */
        }
        .text-pink { color: var(--color-pink); }
        .text-green { color: var(--color-green); }
        .control-display {
            font-weight: 800;
            font-size: 1.875rem; /* text-3xl */
        }
        
        /* Range Slider Track & Thumb */
        input[type=range] {
            width: 100%;
            height: 0.5rem;
            border-radius: 0.5rem;
            appearance: none;
            cursor: pointer;
        }
        #factorA { background-color: #fbcfe8; /* pink-200 */ }
        #factorB { background-color: #a7f3d0; /* green-200 */ }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #f87171;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        input[type=range]::-moz-range-thumb {
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #f87171;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            border: none;
        }

        /* Emoji Selector */
        .emoji-select-group {
            background-color: #fef9c3; /* yellow-100 */
            border: 1px solid #fcd34d; /* border-yellow-400 */
        }
        #emojiSelector {
            width: 100%;
            padding: 0.75rem; /* p-3 */
            font-size: 1.25rem; /* text-xl */
            border-radius: 0.5rem; /* rounded-lg */
            border: 2px solid #fdba74; /* border-orange-300 */
            transition: all 0.15s;
        }

        /* Animation Control */
        .animation-control-group {
            margin-top: 1rem; 
            padding: 1rem; 
            background-color: #fee2e2; /* red-100 */
            border-radius: 0.75rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #f87171; /* border-red-400 */
            text-align: center;
        }
        .speed-dropdown-container {
            margin-bottom: 1rem; 
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .text-red-700 { color: #b91c1c; }
        #animationSpeed {
            padding: 0.5rem; 
            font-size: 1rem; 
            border-radius: 0.5rem; 
            border: 2px solid #fca5a5; /* red-300 */
            transition: all 0.15s;
        }
        #animateButton {
            width: 100%;
            padding: 0.75rem 1.5rem; 
            font-size: 1.25rem; 
            font-weight: 800;
            color: white;
            background-color: var(--color-red);
            border-radius: 0.5rem;
            transition: background-color 0.15s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        #animateButton:hover:not(:disabled) {
            background-color: #b91c1c; /* red-700 */
        }
        #animateButton:disabled {
            opacity: 0.5;
        }

        /* Visualization */
        #visualization {
            padding: 1rem; 
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); /* shadow-inner */
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }
        .outer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem; 
            border-radius: 0.75rem;
            border: 4px solid #f59e0b; /* yellow-500 */
            background-color: #fffbeb; /* yellow-50 */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); /* shadow-xl */
        }
        #emojiGrid {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            column-gap: 0.5rem; 
            padding: 0.5rem; 
            transition: all 0.3s ease-out;
        }
        .column-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            row-gap: 0.375rem; 
            padding: 0.25rem; 
            border-radius: 0.5rem;
            transition: all 0.5s ease-out;
        }
        /* Highlight for the multiplicand (first column) */
        .column-container[data-col="0"] {
            background-color: #bbf7d0; /* green-200 */
            border: 2px solid var(--color-green);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); 
        }
        .column-container span {
            font-size: 1.875rem; /* text-3xl */
            transition: all 0.3s;
        }
        
        /* Result Display */
        .result-display {
            margin-top: 2rem; 
            padding: 1.5rem; 
            background-color: var(--color-blue);
            color: white;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); 
            border: 4px solid #1d4ed8; /* blue-700 */
            text-align: center;
        }
        .result-display p:first-child {
            font-size: 1.5rem; 
            font-weight: 500;
        }
        .result-value {
            font-size: 5rem; 
            font-weight: 800;
            margin-top: 0.5rem;
        }
        .result-A { color: #f9a8d4; /* pink-300 */ }
        .result-B { color: #a7f3d0; /* green-300 */ }
        .result-Total { color: #fcd34d; /* yellow-300 */ }
        .text-blue-500 { color: #3b82f6; }
        .text-red-600 { color: #dc2626; }
    </style>
</head>
<body class="p-4 md:p-8 flex justify-center items-start min-h-screen">

    <div id="app" class="w-full max-w-4xl">
        <!-- Header -->
        <header>
            <h1 class="rainbow-text">å¯å¯æ³¢ä¹˜æ³•æ¢ç´¢ä¹å›­</h1>
           
        </header>

        <!-- Main Content Area -->
        <main>
            
            <!-- Control Panel (Left/Top) -->
            <div class="lg-col-span-1 card control-panel">
                <h2 class="text-purple">ğŸŒŸ è®¾ç½®ä¹˜æ•°</h2>
                
                <!-- Factor A (Row) Control -->
                <div class="control-group">
                    <label for="factorA" class="control-label text-pink">è¢«ä¹˜æ•° (A - ç‰©å“æ•°é‡): <span id="displayA" class="control-display">5</span></label>
                    <input type="range" id="factorA" min="1" max="9" value="5" class="w-full h-2 bg-pink-200 rounded-lg appearance-none cursor-pointer">
                </div>

                <!-- Factor B (Column) Control -->
                <div class="control-group">
                    <label for="factorB" class="control-label text-green">ä¹˜æ•° (B - é‡å¤æ¬¡æ•°): <span id="displayB" class="control-display">5</span></label>
                    <input type="range" id="factorB" min="1" max="9" value="5" class="w-full h-2 bg-green-200 rounded-lg appearance-none cursor-pointer">
                </div>
                
                <!-- Emoji Selector -->
                <div class="control-group emoji-select-group">
                    <label for="emojiSelector" class="control-label" style="color: #f97316;">ğŸ¨ é€‰æ‹©ç‰©å“:</label>
                    <select id="emojiSelector">
                        <option value="â­">â­ æ˜Ÿæ˜Ÿ (Star)</option>
                        <option value="ğŸ">ğŸ è‹¹æœ (Apple)</option>
                        <option value="ğŸˆ">ğŸˆ æ°”çƒ (Balloon)</option>
                        <option value="ğŸš€">ğŸš€ ç«ç®­ (Rocket)</option>
                        <option value="ğŸ‡">ğŸ‡ è‘¡è„ (Grape)</option>
                        <option value="ğŸ‰">ğŸ‰ è¥¿ç“œ (Watermelon)</option>
                        <option value="ğŸŒ">ğŸŒ é¦™è•‰ (Banana)</option>
                        <option value="ğŸ“">ğŸ“ è‰è“ (Strawberry)</option>
                        <option value="ğŸ ">ğŸ  é±¼ (Fish)</option>
                        <option value="ğŸ">ğŸ ç“¢è™« (Ladybug)</option>
                    </select>
                </div>

                <!-- Animation Control -->
                <div class="animation-control-group">
                    
                    <!-- Dropdown for Animation Speed (New) -->
                    <div class="speed-dropdown-container">
                        <label for="animationSpeed" class="text-lg font-semibold text-red-700 mr-2 whitespace-nowrap">åŠ¨ç”»é€Ÿåº¦:</label>
                        <select id="animationSpeed">
                            <option value="1000">1x (é»˜è®¤)</option>
                            <option value="1500">1.5x (æ…¢)</option>
                            <option value="2000">2x (æ›´æ…¢)</option>
                            <option value="3000">3x (æœ€æ…¢)</option>
                            <option value="500">0.5x (å¿«)</option>
                        </select>
                    </div>

                    <button id="animateButton">
                        â–¶ï¸ å¼€å§‹åŠ¨ç”»æ¼”ç¤º
                    </button>
                </div>
            </div>

            <!-- Visualization Area (Right/Bottom) -->
            <div class="lg-col-span-2 card vis-panel">
                <h2 style="color: #0d9488; text-align: center;">ç‰©å“é˜µåˆ—å¯è§†åŒ–</h2>
                
                <!-- Explanation text for the highlight -->
                <p id="multiplicandExplanation" class="explanation-text"></p>

                <div id="visualization">
                    <!-- The stars and column indices will be drawn here -->
                </div>

                <!-- Result Display (Moved) -->
                <div class="result-display">
                    <p>è®¡ç®—ç»“æœï¼š</p>
                    <p class="result-value">
                        <!-- A (è¢«ä¹˜æ•°) uses pink color to match its slider -->
                        <span id="resultA" class="result-A">5</span> 
                        <span style="color: white;">Ã—</span> 
                        <!-- B (ä¹˜æ•°) uses green color to match its slider -->
                        <span id="resultB" class="result-B">5</span> 
                        <span style="color: white;">=</span> 
                        <span id="resultTotal" class="result-Total">25</span>
                    </p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // è·å–æ‰€æœ‰å¿…è¦çš„DOMå…ƒç´ 
        const factorASlider = document.getElementById('factorA');
        const factorBSlider = document.getElementById('factorB');
        const displayA = document.getElementById('displayA');
        const displayB = document.getElementById('displayB');
        const resultA = document.getElementById('resultA');
        const resultB = document.getElementById('resultB');
        const resultTotal = document.getElementById('resultTotal');
        const visualizationDiv = document.getElementById('visualization');
        const emojiSelector = document.getElementById('emojiSelector');
        const multiplicandExplanation = document.getElementById('multiplicandExplanation'); 
        const animateButton = document.getElementById('animateButton');
        const animationSpeedSelector = document.getElementById('animationSpeed'); // New element

        let animationTimeout; // ç”¨äºå­˜å‚¨è®¡æ—¶å™¨IDï¼Œæ–¹ä¾¿æ¸…é™¤

        /**
         * @function updateVisualization
         * æ ¹æ®å½“å‰é€‰æ‹©çš„ä¹˜æ•°Aå’ŒBï¼Œæ›´æ–°æ˜¾ç¤ºå±ä¸Šçš„æ•°å­—å’Œç‰©å“é˜µåˆ—ã€‚
         * @param {boolean} prepareForAnimation - å¦‚æœä¸ºtrueï¼Œåˆ™éšè—é™¤ç¬¬ä¸€åˆ—å¤–çš„æ‰€æœ‰åˆ—ã€‚
         */
        function updateVisualization(prepareForAnimation = false) {
            // æ¸…é™¤ä»»ä½•æ­£åœ¨è¿è¡Œçš„åŠ¨ç”»
            clearTimeout(animationTimeout);
            
            // 1. è·å–ä¹˜æ•° (Factors)
            const A = parseInt(factorASlider.value); // è¢«ä¹˜æ•° - ç‰©å“æ•°é‡
            const B = parseInt(factorBSlider.value); // ä¹˜æ•° - é‡å¤æ¬¡æ•°
            
            // è·å–é€‰æ‹©çš„ Emoji
            const selectedEmoji = emojiSelector.value;

            // 2. æ›´æ–°æ•°å­—æ˜¾ç¤º (Update text displays)
            displayA.textContent = A;
            displayB.textContent = B;
            resultA.textContent = A;
            // ç¡®ä¿ resultB åœ¨é™æ€æ¨¡å¼ä¸‹æ˜¾ç¤ºå®Œæ•´çš„ä¹˜æ•° B
            resultB.textContent = B; 
            resultTotal.textContent = A * B;
            
            // --- ç”Ÿæˆå®Œæ•´çš„é‡å¤åŠ æ³•ç®—å¼ (ç”¨äºé™æ€æ˜¾ç¤º) ---
            const additionArray = new Array(B).fill(A);
            const additionString = additionArray.join(' + ');
            
            // æ›´æ–°è§£é‡Šæ–‡æœ¬
            multiplicandExplanation.innerHTML = 
                `A (${A} ä¸ªç‰©å“) é‡å¤ B (${B} æ¬¡)ï¼Œ<br>` +
                `ç›¸å½“äº ${additionString} = <span class="text-blue-500">${A * B}</span>`;

            // 3. æ¸…ç©ºæ—§çš„é˜µåˆ— 
            visualizationDiv.innerHTML = '';
            
            // 4. åˆ›å»ºæ–°çš„é˜µåˆ— (ä½¿ç”¨ Flex Columns)
            
            // Outer container for the grid
            const outerContainer = document.createElement('div');
            outerContainer.className = 'outer-container'; // Custom class
            
            // Create the grid container
            const gridContainer = document.createElement('div');
            gridContainer.id = 'emojiGrid';
            // ä½¿ç”¨ flex æ¥æ’åˆ—åˆ—
            gridContainer.className = 'emoji-grid'; 
            gridContainer.style.display = 'flex';
            gridContainer.style.justifyContent = 'center';
            gridContainer.style.alignItems = 'flex-start';
            gridContainer.style.columnGap = '0.5rem';
            gridContainer.style.padding = '0.5rem';

            // åˆ›å»º B ä¸ªåˆ—å®¹å™¨
            for (let j = 0; j < B; j++) {
                const colContainer = document.createElement('div');
                colContainer.dataset.col = j;
                // åˆ—å®¹å™¨æ ·å¼
                colContainer.className = 'column-container'; // Custom class
                
                // çªå‡ºæ˜¾ç¤ºç¬¬ä¸€åˆ— (j === 0) ä½œä¸ºè¢«ä¹˜æ•°çš„åŸºæ•°é›†åˆ
                if (j === 0) {
                    // Class styles applied via CSS
                }
                
                // å¦‚æœæ˜¯åŠ¨ç”»å‡†å¤‡é˜¶æ®µï¼Œéšè—éç¬¬ä¸€åˆ—
                if (j > 0 && prepareForAnimation) {
                    colContainer.style.opacity = '0';
                    colContainer.style.transform = 'translateY(10px)'; // ç¨å¾®åç§»ï¼Œè®©åŠ¨ç”»æ›´æ˜æ˜¾
                }
                
                // åœ¨æ¯åˆ—ä¸­åˆ›å»º A ä¸ªç‰©å“
                for (let i = 0; i < A; i++) {
                    const star = document.createElement('span');
                    star.textContent = selectedEmoji; 
                    colContainer.appendChild(star);
                }
                
                gridContainer.appendChild(colContainer);
            }
            
            // ç¼©æ”¾è®¾ç½®
            const scaleFactor = (A * B > 50) ? 0.7 : 1;
            gridContainer.style.transform = `scale(${scaleFactor})`;
            
            // 5. å°†é˜µåˆ—æ”¾å…¥å¤–éƒ¨å®¹å™¨ï¼Œç„¶åæ·»åŠ åˆ°å¯è§†åŒ–åŒºåŸŸ
            outerContainer.appendChild(gridContainer);
            visualizationDiv.appendChild(outerContainer);
            visualizationDiv.scrollTop = 0;

            // 6. æ›´æ–°åŠ¨ç”»æŒ‰é’®çŠ¶æ€
            if (A > 0 && B > 0) {
                animateButton.disabled = false;
                animateButton.textContent = 'â–¶ï¸ å¼€å§‹åŠ¨ç”»æ¼”ç¤º';
            } else {
                animateButton.disabled = true;
                animateButton.textContent = 'âŒ æ— æ³•æ¼”ç¤º (Aæˆ–Bä¸º0)';
            }
        }

        /**
         * @function startAnimation
         * å¯åŠ¨ä¹˜æ³•é‡å¤ç›¸åŠ çš„åŠ¨ç”»æ¼”ç¤ºã€‚
         */
        function startAnimation() {
            clearTimeout(animationTimeout);
            
            const A = parseInt(factorASlider.value);
            const B = parseInt(factorBSlider.value);
            // è·å–é€‰æ‹©çš„åŠ¨ç”»å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            const animationDelay = parseInt(animationSpeedSelector.value); 

            if (A < 1 || B < 1) return;
            
            // 1. è®¾ç½® UI ä¸ºåŠ¨ç”»çŠ¶æ€
            animateButton.textContent = 'â¸ï¸ åŠ¨ç”»è¿›è¡Œä¸­...';
            animateButton.disabled = true;
            factorASlider.disabled = true;
            factorBSlider.disabled = true;
            emojiSelector.disabled = true;
            animationSpeedSelector.disabled = true;

            // 2. é‡æ–°æ¸²æŸ“åˆå§‹çŠ¶æ€ (åªæœ‰ç¬¬ä¸€åˆ—å¯è§ï¼Œå…¶ä»–éšè—)
            updateVisualization(true); 

            const columns = document.querySelectorAll('.column-container');
            
            let currentColumnIndex = 0; // å½“å‰æ­£åœ¨æ˜¾ç¤ºçš„åˆ— (ä» 0 å¼€å§‹)
            let totalItems = 0;

            // åœ¨åŠ¨ç”»å¼€å§‹æ—¶ï¼Œå°†ä¹˜æ•°å’Œæ€»æ•°æ˜¾ç¤ºä¸º 0 (è¡¨ç¤º A x 0)
            resultB.textContent = 0; 
            resultTotal.textContent = 0;

            function nextStep() {
                if (currentColumnIndex >= B) {
                    // åŠ¨ç”»ç»“æŸ
                    animateButton.textContent = 'âœ… åŠ¨ç”»å®Œæˆ';
                    factorASlider.disabled = false;
                    factorBSlider.disabled = false;
                    emojiSelector.disabled = false;
                    animationSpeedSelector.disabled = false;
                    
                    // è®¾ç½®æœ€ç»ˆç»“æœæ–‡æœ¬ (ä¹˜æ•°å’Œæ€»æ•°)
                    resultB.textContent = B; 
                    resultTotal.textContent = A * B;
                    return;
                }

                // å¼•ç”¨å½“å‰åˆ—
                const colElement = columns[currentColumnIndex];

                // 1. åŠ¨ç”»æ•ˆæœï¼šæ˜¾ç¤ºå½“å‰åˆ—
                colElement.style.opacity = '1';
                colElement.style.transform = 'translateY(0) scale(1.05)'; 
                
                // 2. æ›´æ–°è¿è¡Œæ€»æ•°
                totalItems += A;
                
                // 3. æ›´æ–°è®¡ç®—ç»“æœæ˜¾ç¤º (åŒæ­¥æ›´æ–°ä¹˜æ•° B å’Œæ€»æ•°)
                resultB.textContent = currentColumnIndex + 1; 
                resultTotal.textContent = totalItems;
                
                // 4. æ›´æ–°è§£é‡Šæ–‡æœ¬ (é¡¶éƒ¨)
                const currentAdditionArray = new Array(currentColumnIndex + 1).fill(A);
                const currentAdditionString = currentAdditionArray.join(' + ');

                multiplicandExplanation.innerHTML = 
                    `A (${A} ä¸ªç‰©å“) é‡å¤ <span class="text-red-600">${currentColumnIndex + 1}</span> æ¬¡ï¼š<br>` +
                    `å½“å‰æ€»æ•°ï¼š${currentAdditionString} = <span class="text-red-600">${totalItems}</span>`;


                // 5. ç¨å¾®å»¶è¿Ÿåï¼Œç§»é™¤æ”¾å¤§æ•ˆæœ
                setTimeout(() => {
                    colElement.style.transform = 'translateY(0) scale(1)';
                }, 500);

                currentColumnIndex++;

                // 6. è®¾ç½®ä¸‹ä¸€ä¸ªæ­¥éª¤çš„å®šæ—¶å™¨
                if (currentColumnIndex <= B) {
                    // ä½¿ç”¨åŠ¨æ€çš„ animationDelay
                    animationTimeout = setTimeout(nextStep, animationDelay); 
                }
            }

            // ç«‹å³å¯åŠ¨åŠ¨ç”»
            nextStep();
        }

        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        factorASlider.addEventListener('input', () => updateVisualization(false));
        factorBSlider.addEventListener('input', () => updateVisualization(false));
        emojiSelector.addEventListener('change', () => updateVisualization(false));
        animateButton.addEventListener('click', startAnimation);
        // å½“é€Ÿåº¦é€‰æ‹©å™¨æ”¹å˜æ—¶ï¼Œé‡æ–°æ¸²æŸ“é™æ€è§†å›¾ä»¥æ¸…é™¤åŠ¨ç”»å‡†å¤‡çŠ¶æ€
        animationSpeedSelector.addEventListener('change', () => updateVisualization(false)); 

        // é¦–æ¬¡åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œæ˜¾ç¤ºåˆå§‹çŠ¶æ€
        window.onload = () => updateVisualization(false);
    </script>

</body>
</html>
