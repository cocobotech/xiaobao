<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âè§ËØóËØçÂ≠¶‰π†Âç°Áâá</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Sans+MS&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'YouYuan', sans-serif;
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 50%, #c2e9fb 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .loading, .error {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
        }
        
        .loading-content, .error-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #9333ea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .header {
            background: white;
            border-radius: 30px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-title h1 {
            font-size: 2em;
            background: linear-gradient(to right, #9333ea, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-reset {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .btn-reset:hover {
            background: #fecaca;
            transform: translateY(-2px);
        }
        
        .progress-bar {
            margin-top: 10px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .progress-track {
            height: 12px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #9333ea, #ec4899);
            border-radius: 10px;
            transition: width 0.5s;
        }
        
        .poem-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
        }
        
        .poem-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            position: relative;
            text-align: center;
        }
        
        .poem-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .poem-card .emoji {
            font-size: 3.5em;
            margin-bottom: 15px;
        }
        
        .poem-card h3 {
            font-size: 1.2em;
            color: #1f2937;
            margin-bottom: 5px;
        }
        
        .poem-card p {
            font-size: 0.85em;
            color: #6b7280;
        }
        
        .star-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #fbbf24;
            fill: #fbbf24;
        }
        
        .detail-view {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .btn-home {
            background: white;
            color: #9333ea;
        }
        
        .btn-home:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .counter {
            background: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .btn-star {
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .btn-star.active {
            background: #fbbf24;
        }
        
        .poem-detail {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            min-height: 500px;
            margin-bottom: 30px;
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }
        
        .detail-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .detail-title .emoji {
            font-size: 4em;
        }
        
        .detail-title h3 {
            font-size: 2em;
            color: #1f2937;
            font-family: 'YouYuan', 'Microsoft YaHei', sans-serif;
        }
        
        .detail-title .author {
            font-size: 1.1em;
            color: #6b7280;
            margin-top: 5px;
        }
        
        .btn-speak {
            background: #f3e8ff;
            color: #9333ea;
            font-size: 1.1em;
        }
        
        .btn-speak:hover {
            background: #e9d5ff;
        }
        
        .btn-speak.active {
            background: #d1fae5;
            color: #059669;
        }
        
        .poem-content {
            margin-top: 20px;
        }
        
        .poem-line {
            margin-bottom: 40px;
        }
        
        .char-group {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 8px;
            vertical-align: top;
        }
        
        .pinyin {
            font-size: 0.9em;
            color: #9333ea;
            margin-bottom: 8px;
            min-height: 24px;
            font-family: 'Comic Sans MS', 'Trebuchet MS', sans-serif;
            white-space: nowrap;
        }
        
        .chinese {
            font-size: 1.8em;
            color: #1f2937;
            font-family: 'YouYuan', 'Microsoft YaHei', sans-serif;
            line-height: 1;
        }
        
        .nav-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        
        .btn-nav {
            background: white;
            color: #1f2937;
            flex-shrink: 0;
        }
        
        .btn-nav:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            transform: scale(1.05);
        }
        
        .dots {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 10px;
            background: #d1d5db;
            transition: all 0.3s;
        }
        
        .dot.active {
            width: 32px;
            background: #9333ea;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 1200px) {
            .poem-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 900px) {
            .poem-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 600px) {
            .poem-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Loading State -->
        <div id="loadingView" class="loading">
            <div class="loading-content">
                <div class="spinner"></div>
                <p style="font-size: 1.3em; color: #1f2937; font-weight: 600;">Ê≠£Âú®Âä†ËΩΩÂè§ËØóËØç...</p>
            </div>
        </div>
        
        <!-- Error State -->
        <div id="errorView" class="error hidden">
            <div class="error-content">
                <p style="font-size: 1.3em; color: #dc2626; margin-bottom: 20px;">‚ùå Âä†ËΩΩÂ§±Ë¥•</p>
                <button class="btn" onclick="loadPoems()" style="background: #9333ea; color: white;">ÈáçËØï</button>
            </div>
        </div>
        
        <!-- List View -->
        <div id="listView" class="hidden">
            <div class="header">
                <div class="header-top">
                    <div class="header-title">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#9333ea" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        </svg>
                        <div>
                            <h1>Âè§ËØóËØçÂ≠¶‰π†</h1>
                            <p style="font-size: 0.9em; color: #6b7280;">Â∞èÂ≠¶‰∏Ä„ÄÅ‰∫åÂπ¥Á∫ßÂøÖËÉåÂè§ËØó</p>
                        </div>
                    </div>
                    <button class="btn btn-reset" onclick="resetProgress()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                        </svg>
                        ÈáçÁΩÆ
                    </button>
                </div>
                <div class="progress-bar">
                    <div class="progress-info">
                        <span style="color: #6b7280;">Â≠¶‰π†ËøõÂ∫¶</span>
                        <span style="color: #9333ea; font-weight: 700;"><span id="masteredCount">0</span> / <span id="totalCount">0</span></span>
                    </div>
                    <div class="progress-track">
                        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div id="poemGrid" class="poem-grid"></div>
        </div>
        
        <!-- Detail View -->
        <div id="detailView" class="detail-view hidden">
            <div class="nav-header">
                <button class="btn btn-home" onclick="showList()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    ËøîÂõûÂàóË°®
                </button>
                
                <div class="counter">
                    <span style="color: #6b7280;">Á¨¨ <span id="currentNum">1</span> È¶ñ</span>
                    <span style="color: #9333ea; font-weight: 700;"> / <span id="totalNum">0</span></span>
                </div>
                
                <button id="starBtn" class="btn btn-star" onclick="toggleStar()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                </button>
            </div>
            
            <div class="poem-detail">
                <div class="detail-header">
                    <div class="detail-title">
                        <div class="emoji" id="detailEmoji">üìñ</div>
                        <div>
                            <h3 id="detailTitle">ËØóËØçÊ†áÈ¢ò</h3>
                            <p class="author" id="detailAuthor">‰ΩúËÄÖ</p>
                        </div>
                    </div>
                    <button id="speakBtn" class="btn btn-speak" onclick="speakPoem()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        </svg>
                        <span id="speakText">ÊúóËØª</span>
                    </button>
                </div>
                
                <div id="poemContent" class="poem-content"></div>
            </div>
            
            <div class="nav-footer">
                <button class="btn btn-nav" onclick="prevPoem()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    ‰∏ä‰∏ÄÈ¶ñ
                </button>
                
                <div id="dots" class="dots"></div>
                
                <button class="btn btn-nav" onclick="nextPoem()">
                    ‰∏ã‰∏ÄÈ¶ñ
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        let poems = [];
        let currentIndex = 0;
        let mastered = new Set();
        let isReading = false;
        
        const emojiMap = {
            'ÂíèÈπÖ': 'ü¶¢', 'ÈùôÂ§úÊÄù': 'üåô', 'Êò•Êôì': 'üå∏', 'ÊÇØÂÜú': 'üåæ',
            'ÁôªÈπ≥ÈõÄÊ•º': 'üèØ', 'Ê±üÈõ™': '‚ùÑÔ∏è', 'ÁªùÂè•': 'üê¶', 'Ëçâ': 'üå±',
            'ÊùëÂ±Ö': 'ü™Å', 'ÊúõÂ∫êÂ±±ÁÄëÂ∏É': 'üíß', 'Ê∏∏Â≠êÂêü': 'üíù', 'Áôª‰πêÊ∏∏Âéü': 'üåÖ',
            'Â±±Ë°å': 'üçÅ', 'Ê∏ÖÊòé': 'üåßÔ∏è', 'Ê¢ÖËä±': 'üå∫', 'Êó©ÂèëÁôΩÂ∏ùÂüé': '‚õµ',
            'Â§úÂÆøÂ±±ÂØ∫': 'üèîÔ∏è', 'ÈªÑÈπ§Ê•ºÈÄÅÂ≠üÊµ©ÁÑ∂‰πãÂπøÈôµ': 'üõ∂', 'ËµãÂæóÂè§ÂéüËçâÈÄÅÂà´': 'üåø',
            'ÈÄÅÂÖÉ‰∫å‰ΩøÂÆâË•ø': 'üçÉ', 'Áõ∏ÊÄù': '‚ù§Ô∏è', 'ÈπøÊü¥': 'ü¶å', 'Á´πÈáåÈ¶Ü': 'üéã',
            'ÂØíÈ£ü': 'üå¨Ô∏è', 'ÊúõÊ¥ûÂ∫≠': 'üåä', 'Èí±Â°òÊπñÊò•Ë°å': 'üö£', 'Êò•Êúõ': 'üèõÔ∏è',
            'Âõû‰π°ÂÅ∂‰π¶': 'üè†', 'Ëµ†Ê±™‰º¶': 'üåä', 'Ê±üÂçóÊò•': 'üåø'
        };
        
        async function loadPoems() {
            try {
                document.getElementById('loadingView').classList.remove('hidden');
                document.getElementById('errorView').classList.add('hidden');
                
                const response = await fetch('https://raw.githubusercontent.com/cocobotech/xiaobao/main/apps/cn/poetry_g1_g2.md');
                if (!response.ok) throw new Error('Failed to load');
                
                const text = await response.text();
                poems = parseMarkdown(text);
                
                document.getElementById('loadingView').classList.add('hidden');
                showList();
            } catch (error) {
                document.getElementById('loadingView').classList.add('hidden');
                document.getElementById('errorView').classList.remove('hidden');
            }
        }
        
        function parseMarkdown(markdown) {
            const result = [];
            const sections = markdown.split('###').slice(1);
            
            sections.forEach((section, index) => {
                const lines = section.trim().split('\n').filter(line => line.trim());
                if (lines.length < 2) return;
                
                const titleLine = lines[0].trim();
                const titleMatch = titleLine.match(/^(\d+)\.\s*(.+?)\s*‚Äî\s*(.+?)$/);
                if (!titleMatch) return;
                
                const title = titleMatch[2].trim();
                const author = titleMatch[3].trim();
                
                const content = [];
                const pinyin = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line || line.startsWith('**') || line.startsWith('---') || line.startsWith('#')) continue;
                    
                    if (/[\u4e00-\u9fa5]/.test(line) && !line.match(/^[a-zA-Z]/)) {
                        content.push(line);
                    } else if (line.match(/^[a-zA-Z]/i) && line.includes('„ÄÇ')) {
                        pinyin.push(line);
                    }
                }
                
                if (content.length > 0 && pinyin.length > 0) {
                    result.push({
                        id: index + 1,
                        title,
                        author,
                        content,
                        pinyin,
                        emoji: emojiMap[title] || 'üìñ'
                    });
                }
            });
            
            return result;
        }
        
        function showList() {
            document.getElementById('listView').classList.remove('hidden');
            document.getElementById('detailView').classList.add('hidden');
            updateProgress();
            renderGrid();
        }
        
        function showDetail(index) {
            currentIndex = index;
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('detailView').classList.remove('hidden');
            renderDetail();
        }
        
        function renderGrid() {
            const grid = document.getElementById('poemGrid');
            grid.innerHTML = '';
            
            poems.forEach((poem, index) => {
                const card = document.createElement('div');
                card.className = 'poem-card';
                card.onclick = () => showDetail(index);
                
                if (mastered.has(poem.id)) {
                    card.innerHTML += `<svg class="star-badge" width="20" height="20" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`;
                }
                
                card.innerHTML += `
                    <div class="emoji">${poem.emoji}</div>
                    <h3>${poem.title}</h3>
                    <p>${poem.author}</p>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function renderDetail() {
            const poem = poems[currentIndex];
            
            document.getElementById('detailEmoji').textContent = poem.emoji;
            document.getElementById('detailTitle').textContent = poem.title;
            document.getElementById('detailAuthor').textContent = '‚Äî‚Äî ' + poem.author;
            document.getElementById('currentNum').textContent = currentIndex + 1;
            document.getElementById('totalNum').textContent = poems.length;
            
            const content = document.getElementById('poemContent');
            content.innerHTML = '';
            
            poem.content.forEach((line, idx) => {
                const div = document.createElement('div');
                div.className = 'poem-line';
                
                // Remove all spaces from Chinese line
                const chineseChars = line.replace(/\s+/g, '');
                
                // Split pinyin and clean up
                const pinyinLine = poem.pinyin[idx] || '';
                // Remove punctuation from pinyin, split by space
                const pinyinParts = pinyinLine
                    .replace(/[Ôºå„ÄÇ„ÄÅÔºÅÔºüÔºõÔºö""''ÔºàÔºâ,.\!?;:""''()]/g, ' ')
                    .split(/\s+/)
                    .filter(p => p.length > 0);
                
                let html = '';
                let pinyinIndex = 0;
                
                for (let i = 0; i < chineseChars.length; i++) {
                    const char = chineseChars[i];
                    // Check if character is Chinese
                    if (/[\u4e00-\u9fa5]/.test(char)) {
                        const py = pinyinParts[pinyinIndex] || '';
                        html += `
                            <span class="char-group">
                                <span class="pinyin">${py}</span>
                                <span class="chinese">${char}</span>
                            </span>
                        `;
                        pinyinIndex++;
                    } else {
                        // Punctuation
                        html += `
                            <span class="char-group">
                                <span class="pinyin"></span>
                                <span class="chinese">${char}</span>
                            </span>
                        `;
                    }
                }
                
                div.innerHTML = html;
                content.appendChild(div);
            });
            
            updateStarButton();
            updateDots();
        }
        
        function updateProgress() {
            document.getElementById('masteredCount').textContent = mastered.size;
            document.getElementById('totalCount').textContent = poems.length;
            const percent = Math.round((mastered.size / poems.length) * 100);
            document.getElementById('progressFill').style.width = percent + '%';
        }
        
        function updateStarButton() {
            const btn = document.getElementById('starBtn');
            const poem = poems[currentIndex];
            
            if (mastered.has(poem.id)) {
                btn.classList.add('active');
                btn.querySelector('svg').style.fill = 'white';
                btn.querySelector('svg').style.stroke = 'white';
            } else {
                btn.classList.remove('active');
                btn.querySelector('svg').style.fill = 'none';
                btn.querySelector('svg').style.stroke = 'currentColor';
            }
        }
        
        function updateDots() {
            const dots = document.getElementById('dots');
            dots.innerHTML = '';
            
            const max = Math.min(10, poems.length);
            for (let i = 0; i < max; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot' + (i === currentIndex ? ' active' : '');
                dots.appendChild(dot);
            }
        }
        
        function toggleStar() {
            const poem = poems[currentIndex];
            if (mastered.has(poem.id)) {
                mastered.delete(poem.id);
            } else {
                mastered.add(poem.id);
            }
            updateStarButton();
        }
        
        function resetProgress() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÂ≠¶‰π†ËøõÂ∫¶ÂêóÔºü')) {
                mastered.clear();
                updateProgress();
            }
        }
        
        function speakPoem() {
            if (!('speechSynthesis' in window)) {
                alert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÂäüËÉΩ');
                return;
            }
            
            if (isReading) {
                window.speechSynthesis.cancel();
                isReading = false;
                document.getElementById('speakText').textContent = 'ÊúóËØª';
                document.getElementById('speakBtn').classList.remove('active');
                return;
            }
            
            const poem = poems[currentIndex];
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance();
            utterance.text = `${poem.title}Ôºå${poem.author}„ÄÇ${poem.content.join('Ôºå')}`;
            utterance.lang = 'zh-CN';
            utterance.rate = 0.7;
            utterance.pitch = 1.1;
            
            isReading = true;
            document.getElementById('speakText').textContent = 'ÊúóËØª‰∏≠...';
            document.getElementById('speakBtn').classList.add('active');
            
            utterance.onend = () => {
                isReading = false;
                document.getElementById('speakText').textContent = 'ÊúóËØª';
                document.getElementById('speakBtn').classList.remove('active');
            };
            
            utterance.onerror = () => {
                isReading = false;
                document.getElementById('speakText').textContent = 'ÊúóËØª';
                document.getElementById('speakBtn').classList.remove('active');
            };
            
            window.speechSynthesis.speak(utterance);
        }
        
        function nextPoem() {
            currentIndex = (currentIndex + 1) % poems.length;
            renderDetail();
        }
        
        function prevPoem() {
            currentIndex = (currentIndex - 1 + poems.length) % poems.length;
            renderDetail();
        }
        
        // Load poems on page load
        loadPoems();
    </script>
</body>
</html>
